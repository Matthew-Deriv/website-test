<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>mvapi &mdash; API Testing Automation Project 0.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=92fd9be5" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=7e3e2e94" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=d45e8c67"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            API Testing Automation Project
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"></div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">API Testing Automation Project</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Module code</a></li>
      <li class="breadcrumb-item active">mvapi</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for mvapi</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># coding: utf-8</span>

<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">clear_output</span>
<span class="c1"># display(HTML(&quot;&lt;style&gt;.container { width:100% !important; }&lt;/style&gt;&quot;))</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">websocket</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">norm</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">fsolve</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">yaml</span>


<span class="c1"># {&#39;contract_type&#39;: &#39;Not in enum list: MULTUP, MULTDOWN, UPORDOWN, EXPIRYRANGE, ONETOUCH, CALLE, LBHIGHLOW, ASIAND, EXPIRYRANGEE, </span>
<span class="c1"># DIGITDIFF, DIGITMATCH, DIGITOVER, PUTE, DIGITUNDER, NOTOUCH, CALL, RANGE, LBFLOATPUT, DIGITODD, PUT, ASIANU, LBFLOATCALL, </span>
<span class="c1"># EXPIRYMISSE, EXPIRYMISS, DIGITEVEN, TICKHIGH, TICKLOW, RESETCALL, RESETPUT, CALLSPREAD, PUTSPREAD, RUNHIGH, RUNLOW, ACCU, </span>
<span class="c1"># VANILLALONGCALL, VANILLALONGPUT, TURBOSLONG, TURBOSSHORT.&#39;},</span>
<span class="c1">#   &#39;message&#39;: &#39;Input validation failed: contract_type&#39;},</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Import constants using yaml safe-loading.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;SYMBOLS.yaml&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">symbols</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">yaml</span><span class="o">.</span><span class="n">YAMLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;BO.yaml&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">BO</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">yaml</span><span class="o">.</span><span class="n">YAMLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;LOSS_PROBS.yaml&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">default_loss_probs</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">yaml</span><span class="o">.</span><span class="n">YAMLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;CONTRACT_TYPES.yaml&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">contract_types</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">yaml</span><span class="o">.</span><span class="n">YAMLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

<div class="viewcode-block" id="accu_tick_size_barrier_builder">
<a class="viewcode-back" href="../index.html#mvapi.accu_tick_size_barrier_builder">[docs]</a>
<span class="k">def</span> <span class="nf">accu_tick_size_barrier_builder</span><span class="p">(</span><span class="n">loss_probs</span><span class="o">=</span><span class="n">default_loss_probs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Builds the tick size barriers for each growth rate for each symbol based on their loss probabilities.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    loss_probs : dict, optional</span>
<span class="sd">        A dictionary with keys as growth rates and values as corresponding loss probabilities.</span>
<span class="sd">        Defaults to `default_loss_probs`.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Run at the start to build the tick size barrier for each growth rate for each symbol based on preset default values.</span>
<span class="sd">    </span>
<span class="sd">    The function updates the tick size barrier for each growth rate for each symbol in the &#39;symbols&#39; dictionary</span>
<span class="sd">    by solving for the barrier for each growth rate using the given loss probabilities. </span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; loss_probs = {&#39;0.01&#39;: 0.01, &#39;0.02&#39;: 0.02, &#39;0.03&#39;: 0.03, &#39;0.04&#39;: 0.04, &#39;0.05&#39;: 0.05}</span>
<span class="sd">    &gt;&gt;&gt; accu_tick_size_barrier_builder(loss_probs)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">for</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="n">symbols</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">symbols</span><span class="p">[</span><span class="n">symbol</span><span class="p">][</span><span class="s1">&#39;accu&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;barrier&#39;</span> <span class="p">:</span> <span class="p">{}}</span>

    <span class="k">def</span> <span class="nf">gbm</span><span class="p">(</span><span class="n">barrier</span><span class="p">,</span> <span class="n">loss_prob</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">symbol</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="k">if</span> <span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">symbol</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">365</span><span class="o">/</span><span class="mi">86400</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">t</span>
        <span class="n">sd</span> <span class="o">=</span> <span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">t</span>
        <span class="n">prob_b1</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">barrier</span><span class="p">)</span><span class="o">-</span><span class="n">mu</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sd</span><span class="p">))</span>
        <span class="n">prob_b2</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">barrier</span><span class="p">)</span><span class="o">-</span><span class="n">mu</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sd</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">prob_b1</span> <span class="o">+</span> <span class="n">prob_b2</span> <span class="o">-</span> <span class="n">loss_prob</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">growth_rate</span> <span class="ow">in</span> <span class="n">loss_probs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">loss_prob</span> <span class="o">=</span> <span class="n">loss_probs</span><span class="p">[</span><span class="n">growth_rate</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="n">symbols</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">sigma</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">[</span><span class="n">symbol</span><span class="p">][</span><span class="s1">&#39;sigma&#39;</span><span class="p">]</span>
            <span class="n">symbols</span><span class="p">[</span><span class="n">symbol</span><span class="p">][</span><span class="s1">&#39;accu&#39;</span><span class="p">][</span><span class="s1">&#39;barrier&#39;</span><span class="p">][</span><span class="n">growth_rate</span><span class="p">]</span> <span class="o">=</span> <span class="n">fsolve</span><span class="p">(</span><span class="n">gbm</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">loss_prob</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">symbol</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span></div>


<span class="n">accu_tick_size_barrier_builder</span><span class="p">()</span>

<div class="viewcode-block" id="insert_dict">
<a class="viewcode-back" href="../index.html#mvapi.insert_dict">[docs]</a>
<span class="k">def</span> <span class="nf">insert_dict</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">_dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Insert or update a dictionary into the key of the given item.</span>

<span class="sd">    This function attempts to update the specified key of the provided item with the </span>
<span class="sd">    key-value pairs from the provided dictionary. If the key does not exist in the item, </span>
<span class="sd">    it initializes the key as an empty dictionary before performing the update.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    item : dict</span>
<span class="sd">        The dictionary in which the key-value pairs are to be inserted or updated.</span>
<span class="sd">    key : str</span>
<span class="sd">        The key within the item dictionary to be updated with the provided dictionary.</span>
<span class="sd">    _dict : dict</span>
<span class="sd">        The dictionary containing key-value pairs to be inserted or updated into the item.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; item = {&#39;a&#39;: {}}</span>
<span class="sd">    &gt;&gt;&gt; insert_dict(item, &#39;b&#39;, {&#39;y&#39;: 2})</span>
<span class="sd">    &gt;&gt;&gt; print(item)</span>
<span class="sd">    {&#39;a&#39;: {}, &#39;b&#39;: {&#39;y&#39;: 2}}</span>

<span class="sd">    &gt;&gt;&gt; item = {&#39;a&#39;: {}, &#39;b&#39;: {}}</span>
<span class="sd">    &gt;&gt;&gt; insert_dict(item, &#39;b&#39;, {&#39;y&#39;: 2})</span>
<span class="sd">    &gt;&gt;&gt; print(item)</span>
<span class="sd">    {&#39;a&#39;: {}, &#39;b&#39;: {&#39;y&#39;: 2}}</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span> 
        <span class="n">item</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">_dict</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">item</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">item</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">_dict</span><span class="p">)</span></div>


<div class="viewcode-block" id="dict_to_df">
<a class="viewcode-back" href="../index.html#mvapi.dict_to_df">[docs]</a>
<span class="k">def</span> <span class="nf">dict_to_df</span><span class="p">(</span><span class="n">_dict</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a dictionary to a pandas DataFrame.</span>

<span class="sd">    This function takes a dictionary and converts it to a pandas DataFrame. The dictionary&#39;s keys </span>
<span class="sd">    become a &#39;Category&#39; column in the DataFrame, and the associated values become other columns. </span>
<span class="sd">    If the dictionary cannot be converted, it creates a DataFrame with the dictionary&#39;s content.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    _dict : dict</span>
<span class="sd">        The dictionary to be converted to a DataFrame.</span>
<span class="sd">    title : str</span>
<span class="sd">        The title to be printed alongside the DataFrame for identification.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pd.DataFrame</span>
<span class="sd">        The resulting DataFrame created from the dictionary.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; _dict = {&#39;A&#39;: {&#39;value1&#39;: 10, &#39;value2&#39;: 20}, &#39;B&#39;: {&#39;value1&#39;: 30, &#39;value2&#39;: 40}}</span>
<span class="sd">    &gt;&gt;&gt; df = dict_to_df(_dict, &#39;Example Title&#39;)</span>
<span class="sd">    Stats for Example Title check</span>
<span class="sd">    &gt;&gt;&gt; display(df)</span>
<span class="sd">    Category  value1  value2</span>
<span class="sd">    0        A      10      20</span>
<span class="sd">    1        B      30      40</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span> 
        <span class="n">flattened_data</span> <span class="o">=</span> <span class="p">[{</span><span class="o">**</span><span class="p">{</span><span class="s1">&#39;Category&#39;</span><span class="p">:</span> <span class="n">sub_key</span><span class="p">},</span> <span class="o">**</span><span class="n">values</span><span class="p">}</span> <span class="k">for</span> <span class="n">sub_key</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">flattened_data</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">_dict</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Stats for&#39;</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="s1">&#39;check&#39;</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span></div>


<div class="viewcode-block" id="get_sigma">
<a class="viewcode-back" href="../index.html#mvapi.get_sigma">[docs]</a>
<span class="k">def</span> <span class="nf">get_sigma</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the sigma value for a given symbol.</span>

<span class="sd">    This function retrieves the &#39;sigma&#39; value associated with the provided symbol </span>
<span class="sd">    from a predefined symbols dictionary.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    symbol : str</span>
<span class="sd">        The symbol for which the sigma value is to be retrieved.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        The sigma value associated with the given symbol.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; get_sigma(&#39;1HZ75V&#39;)</span>
<span class="sd">    0.75</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">symbols</span><span class="p">[</span><span class="n">symbol</span><span class="p">][</span><span class="s1">&#39;sigma&#39;</span><span class="p">]</span></div>


<div class="viewcode-block" id="get_stake">
<a class="viewcode-back" href="../index.html#mvapi.get_stake">[docs]</a>
<span class="k">def</span> <span class="nf">get_stake</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the stake amount from a given proposal.</span>

<span class="sd">    This function calculates the stake amount from the provided proposal by subtracting </span>
<span class="sd">    the app markup amount from the proposal&#39;s requested amount. If the app markup amount </span>
<span class="sd">    is not available, it returns the requested amount.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    prop : dict</span>
<span class="sd">        The proposal from which the stake amount is to be retrieved.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        The calculated stake amount from the given proposal.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; prop = {</span>
<span class="sd">    ...     &#39;echo_req&#39;: {&#39;amount&#39;: 100},</span>
<span class="sd">    ...     &#39;proposal&#39;: {&#39;contract_details&#39;: {&#39;app_markup_amount&#39;: &#39;5&#39;}}</span>
<span class="sd">    ... }</span>
<span class="sd">    &gt;&gt;&gt; get_stake(prop)</span>
<span class="sd">    95.0</span>

<span class="sd">    &gt;&gt;&gt; prop = {</span>
<span class="sd">    ...     &#39;echo_req&#39;: {&#39;amount&#39;: 100}</span>
<span class="sd">    ... }</span>
<span class="sd">    &gt;&gt;&gt; get_stake(prop)</span>
<span class="sd">    100.0</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">stake</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;echo_req&#39;</span><span class="p">][</span><span class="s1">&#39;amount&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal&#39;</span><span class="p">][</span><span class="s1">&#39;contract_details&#39;</span><span class="p">][</span><span class="s1">&#39;app_markup_amount&#39;</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">stake</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;echo_req&#39;</span><span class="p">][</span><span class="s1">&#39;amount&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">stake</span> </div>


<div class="viewcode-block" id="roundsf">
<a class="viewcode-back" href="../index.html#mvapi.roundsf">[docs]</a>
<span class="k">def</span> <span class="nf">roundsf</span><span class="p">(</span><span class="n">number</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Round a number to retain only the first non-zero digit.</span>

<span class="sd">    This function takes a number, retains only the first non-zero digit, and </span>
<span class="sd">    replaces all following digits with zeros.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    number : float</span>
<span class="sd">        The number to be rounded.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        The rounded numeric value.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; roundsf(123.456)</span>
<span class="sd">    100.0</span>

<span class="sd">    &gt;&gt;&gt; roundsf(0.00456)</span>
<span class="sd">    0.004</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">number</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{:.15f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
    <span class="n">non_zero_index</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;[^0.]&#39;</span><span class="p">,</span> <span class="n">number</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>        
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">number</span><span class="p">[:</span><span class="n">non_zero_index</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;[0-9]&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="n">number</span><span class="p">[</span><span class="n">non_zero_index</span><span class="o">+</span><span class="mi">1</span><span class="p">:]))</span></div>


<div class="viewcode-block" id="roundup">
<a class="viewcode-back" href="../index.html#mvapi.roundup">[docs]</a>
<span class="k">def</span> <span class="nf">roundup</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Round up a number to the specified precision.</span>

<span class="sd">    This function rounds up a number to the specified number of decimal places.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    num : float</span>
<span class="sd">        The number to be rounded up.</span>
<span class="sd">    prec : int</span>
<span class="sd">        The number of decimal places to round up to.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        The number rounded up to the specified precision.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; roundup(123.456, 2)</span>
<span class="sd">    123.46</span>

<span class="sd">    &gt;&gt;&gt; roundup(0.00456, 3)</span>
<span class="sd">    0.005</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">round</span><span class="p">((</span><span class="n">num</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="n">prec</span><span class="p">),</span><span class="mi">15</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="n">prec</span><span class="p">)</span></div>


<div class="viewcode-block" id="rounddown">
<a class="viewcode-back" href="../index.html#mvapi.rounddown">[docs]</a>
<span class="k">def</span> <span class="nf">rounddown</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Round down a number to the specified precision.</span>

<span class="sd">    This function rounds down a number to the specified number of decimal places.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    num : float</span>
<span class="sd">        The number to be rounded down.</span>
<span class="sd">    prec : int</span>
<span class="sd">        The number of decimal places to round down to.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        The number rounded down to the specified precision.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; rounddown(123.456, 2)</span>
<span class="sd">    123.45</span>

<span class="sd">    &gt;&gt;&gt; rounddown(0.00456, 3)</span>
<span class="sd">    0.004</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="nb">round</span><span class="p">((</span><span class="n">num</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="n">prec</span><span class="p">),</span><span class="mi">15</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="n">prec</span><span class="p">)</span></div>


<div class="viewcode-block" id="set_limit_orders">
<a class="viewcode-back" href="../index.html#mvapi.set_limit_orders">[docs]</a>
<span class="k">def</span> <span class="nf">set_limit_orders</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">take_profit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stop_loss</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sets the take profit and stop loss limits for the given object.</span>

<span class="sd">    This function updates the take profit and stop loss attributes of the object if they are</span>
<span class="sd">    specified and valid to be set according to the contract types.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    obj : object</span>
<span class="sd">        The object whose limit orders are to be set.</span>

<span class="sd">    take_profit : float, int, optional</span>
<span class="sd">        The take profit value to be set. Defaults to None.</span>

<span class="sd">    stop_loss : float, int, optional</span>
<span class="sd">        The stop loss value to be set. Defaults to None.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">    &quot;&quot;&quot;</span>    
    <span class="nb">print</span><span class="p">(</span><span class="n">contract_types</span><span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">species</span><span class="p">][</span><span class="s1">&#39;stop_loss&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">contract_types</span><span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">species</span><span class="p">][</span><span class="s1">&#39;take_profit&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">take_profit</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">]:</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">take_profit</span> <span class="o">=</span> <span class="n">take_profit</span>
    <span class="k">if</span> <span class="n">contract_types</span><span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">species</span><span class="p">][</span><span class="s1">&#39;stop_loss&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">stop_loss</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">]:</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">stop_loss</span> <span class="o">=</span> <span class="n">stop_loss</span></div>


<div class="viewcode-block" id="Product">
<a class="viewcode-back" href="../index.html#mvapi.Product">[docs]</a>
<span class="k">class</span> <span class="nc">Product</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A base class to represent a product for trading contracts through DerivAPI via WebSocket.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    api_token : str</span>
<span class="sd">        API token for authentication.</span>
<span class="sd">    stake : int</span>
<span class="sd">        The amount to stake in each trade.</span>
<span class="sd">    symbol : str</span>
<span class="sd">        The underlying symbol of the product.</span>
<span class="sd">    messages : list</span>
<span class="sd">        List to store messages received from the WebSocket.</span>
<span class="sd">    endpoint : str</span>
<span class="sd">        The WebSocket endpoint.</span>
<span class="sd">    retry : int</span>
<span class="sd">        Counter for retry attempts when sending/receiving messages.</span>
<span class="sd">    contract_ids : list</span>
<span class="sd">        List of contract IDs.</span>
<span class="sd">    ws : WebSocket</span>
<span class="sd">        WebSocket connection object.</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    _set_attributes(**kwargs) : None</span>
<span class="sd">        Sets multiple attributes from keyword arguments.</span>
<span class="sd">    _set_app_details() : None</span>
<span class="sd">        Saves application details like endpoint and API token.</span>
<span class="sd">    _get_app_markup() : float</span>
<span class="sd">        Retrieves the application markup percentage.</span>
<span class="sd">    _get_app_id(string) : int</span>
<span class="sd">        Extracts the application ID from the endpoint URL.</span>
<span class="sd">    _proposal() : str</span>
<span class="sd">        Generates a proposal based on the current proposal type.</span>
<span class="sd">    _send() : dict</span>
<span class="sd">        Sends a proposal to the WebSocket and handles the response.</span>
<span class="sd">    send_message(message) : dict</span>
<span class="sd">        Sends a user-defined JSON message to the WebSocket.</span>
<span class="sd">    stream() : int</span>
<span class="sd">        Streams data from the WebSocket.</span>
<span class="sd">    price_proposal(random=False, buy=False, take_profit=0, stop_loss=0, **kwargs) : bool</span>
<span class="sd">        Gets a price proposal.</span>
<span class="sd">    buy_contract(runs=1, random=False, **kwargs) : None</span>
<span class="sd">        Attempts to buy a contract.</span>
<span class="sd">    contract_proposal(contract_id=None, subscribe=0) : None</span>
<span class="sd">        Gets contract details and optionally subscribes to updates.</span>
<span class="sd">    get_all_poc() : None</span>
<span class="sd">        Gets all proposal open contracts from saved contract IDs.</span>
<span class="sd">    tick_history(symbol=False, count=1, end=&#39;latest&#39;) : dict</span>
<span class="sd">        Retrieves historical tick data.</span>
<span class="sd">    _check_connection() : None</span>
<span class="sd">        Checks the WebSocket connection and reopens it if closed.</span>
<span class="sd">    _check_closed() : int</span>
<span class="sd">        Checks if a contract is closed.</span>
<span class="sd">    sell_contract(contract_id=None) : None</span>
<span class="sd">        Attempts to sell a contract.</span>
<span class="sd">    sell_all_contracts() : None</span>
<span class="sd">        Attempts to sell all contracts.</span>
<span class="sd">    create_ws() : None</span>
<span class="sd">        Creates a new WebSocket connection.</span>
<span class="sd">    authorise() : int</span>
<span class="sd">        Authorises the WebSocket connection.</span>
<span class="sd">    _recv_msg_handler() : int</span>
<span class="sd">        Handles messages received from the WebSocket.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    
<div class="viewcode-block" id="Product.__init__">
<a class="viewcode-back" href="../index.html#mvapi.Product.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes a new instance of the Product class.</span>

<span class="sd">        This constructor sets the initial attributes for the product, including default values </span>
<span class="sd">        for stake, symbol, endpoint, and others. It also creates a WebSocket connection and </span>
<span class="sd">        authorizes it if an API token is provided. Additionally, it sets application details.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        **kwargs : dict</span>
<span class="sd">            Additional attributes to be set for the instance.</span>

<span class="sd">        Attributes</span>
<span class="sd">        ----------</span>
<span class="sd">        stake : int</span>
<span class="sd">            The amount to stake in each trade. Defaults to 10.</span>
<span class="sd">        symbol : str</span>
<span class="sd">            The symbol of the product. Defaults to &#39;1HZ100V&#39;.</span>
<span class="sd">        take_profit : int</span>
<span class="sd">            The take profit amount in each trade. Defaults to 0.</span>
<span class="sd">        stop_loss : int</span>
<span class="sd">            The stop loss amount in each trade. Defaults to 0.            </span>
<span class="sd">        messages : list</span>
<span class="sd">            List to store messages received from the WebSocket. Initialized as an empty list.</span>
<span class="sd">        endpoint : str</span>
<span class="sd">            The WebSocket endpoint. Defaults to &quot;wss://blue.derivws.com/websockets/v3?app_id=16929&quot;.</span>
<span class="sd">        api_token : int</span>
<span class="sd">            API token for authentication. Defaults to 0.</span>
<span class="sd">        retry : int</span>
<span class="sd">            Counter for retry attempts when sending/receiving messages. Initialized to 0.</span>
<span class="sd">        contract_ids : list</span>
<span class="sd">            List of contract IDs. Initialized as an empty list.</span>
<span class="sd">        stats : dict</span>
<span class="sd">            Dictionary to store statistics. Initialized as an empty dictionary.</span>
<span class="sd">        app_details : dict</span>
<span class="sd">            Dictionary to store application details. Initialized as an empty dictionary.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">stake</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symbol</span> <span class="o">=</span> <span class="s1">&#39;1HZ100V&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">take_profit</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_loss</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">messages</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">endpoint</span> <span class="o">=</span> <span class="s2">&quot;wss://blue.derivws.com/websockets/v3?app_id=16929&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_token</span> <span class="o">=</span> <span class="mi">0</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">retry</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contract_ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_ws</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_token</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">authorise</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app_details</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_app_details</span><span class="p">()</span></div>

    
<div class="viewcode-block" id="Product._set_attributes">
<a class="viewcode-back" href="../index.html#mvapi.Product._set_attributes">[docs]</a>
    <span class="k">def</span> <span class="nf">_set_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets multiple attributes from keyword arguments.</span>

<span class="sd">        This method updates the instance&#39;s attributes based on the provided keyword arguments. </span>
<span class="sd">        If the &#39;take_profit&#39; or &#39;stoploss&#39; attributes are updated, it&#39;ll call &#39;set_limit_orders&#39; method.</span>
<span class="sd">        If the &#39;endpoint&#39; or &#39;api_token&#39; attributes are updated, it also updates application details </span>
<span class="sd">        and performs additional actions like creating a WebSocket connection or authorizing the connection.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        **kwargs : dict</span>
<span class="sd">            Keyword arguments representing attribute names and their values.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">match</span> <span class="n">key</span><span class="p">:</span>
                <span class="k">case</span> <span class="s1">&#39;endpoint&#39;</span><span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_set_app_details</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">create_ws</span><span class="p">()</span>
                <span class="k">case</span> <span class="s1">&#39;api_token&#39;</span><span class="p">:</span> 
                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_set_app_details</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">authorise</span><span class="p">()</span>
                <span class="k">case</span> <span class="s1">&#39;take_profit&#39;</span><span class="p">:</span>
                    <span class="n">set_limit_orders</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">take_profit</span><span class="o">=</span><span class="n">value</span><span class="p">)</span> 
                <span class="k">case</span> <span class="s1">&#39;stop_loss&#39;</span><span class="p">:</span>
                    <span class="n">set_limit_orders</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stop_loss</span><span class="o">=</span><span class="n">value</span><span class="p">)</span> 
                <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>


<div class="viewcode-block" id="Product._set_app_details">
<a class="viewcode-back" href="../index.html#mvapi.Product._set_app_details">[docs]</a>
    <span class="k">def</span> <span class="nf">_set_app_details</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves application details such as endpoint, API token, app ID, and app markup percentage.</span>

<span class="sd">        This method updates the `app_details` attribute with the current endpoint and API token. </span>
<span class="sd">        It also retrieves and adds the application ID and markup percentage to the `app_details`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app_details</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;endpoint&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">endpoint</span><span class="p">,</span>
            <span class="s1">&#39;api_token&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_token</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app_details</span><span class="p">[</span><span class="s1">&#39;app_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_app_id</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endpoint</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app_details</span><span class="p">[</span><span class="s1">&#39;app_markup_percentage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_app_markup</span><span class="p">()</span></div>


<div class="viewcode-block" id="Product._get_app_markup">
<a class="viewcode-back" href="../index.html#mvapi.Product._get_app_markup">[docs]</a>
    <span class="k">def</span> <span class="nf">_get_app_markup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves the application markup percentage.</span>

<span class="sd">        This method sends a request to get the application markup percentage after authorizing the WebSocket connection. </span>
<span class="sd">        If an error occurs or the markup percentage is not available, it returns 0.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            The application markup percentage. Defaults to 0 if not retrievable.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">authorise</span><span class="p">():</span>
            <span class="n">temp_message</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;app_get&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">app_details</span><span class="p">[</span><span class="s1">&#39;app_id&#39;</span><span class="p">]</span>
            <span class="p">}</span>   
            <span class="bp">self</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">temp_message</span><span class="p">)</span>
            
        <span class="k">try</span><span class="p">:</span>
            <span class="n">app_markup_percentage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_msg</span><span class="p">[</span><span class="s1">&#39;app_get&#39;</span><span class="p">][</span><span class="s1">&#39;app_markup_percentage&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">app_markup_percentage</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">app_markup_percentage</span></div>


<div class="viewcode-block" id="Product._get_app_id">
<a class="viewcode-back" href="../index.html#mvapi.Product._get_app_id">[docs]</a>
    <span class="k">def</span> <span class="nf">_get_app_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extracts the application ID from the endpoint URL.</span>

<span class="sd">        This method parses the `app_id` from the endpoint URL string. </span>
<span class="sd">        If parsing fails, it returns 0.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        string : str</span>
<span class="sd">            The endpoint URL from which to extract the application ID.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            The extracted application ID. Defaults to 0 if not found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">app_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;app_id=(\d+)&quot;</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">app_id</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">app_id</span></div>


<div class="viewcode-block" id="Product._proposal">
<a class="viewcode-back" href="../index.html#mvapi.Product._proposal">[docs]</a>
    <span class="k">def</span> <span class="nf">_proposal</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates a proposal based on the current proposal type.</span>

<span class="sd">        This method creates a JSON proposal based on the value of `proposal_type`. </span>
<span class="sd">        It handles different proposal types such as buying a contract, </span>
<span class="sd">        requesting a proposal, selling a contract, or raises an error if the type is not implemented.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            The JSON string representation of the proposal.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        NotImplementedError</span>
<span class="sd">            If the `proposal_type` is &#39;price_proposal&#39;, indicating that this method should be used via a subclass.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">proposal</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">proposal_type</span> <span class="o">==</span> <span class="s1">&#39;buy_contract&#39;</span><span class="p">:</span>
            <span class="n">proposal</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;buy&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">proposal_id</span><span class="p">,</span>
                <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">stake</span>
            <span class="p">}</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">proposal_type</span> <span class="o">==</span> <span class="s1">&#39;contract_proposal&#39;</span><span class="p">:</span>
            <span class="n">proposal</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;proposal_open_contract&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;contract_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">contract_id</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subscribe</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">proposal</span><span class="p">[</span><span class="s2">&quot;subscribe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">proposal_type</span> <span class="o">==</span> <span class="s1">&#39;sell_contract&#39;</span><span class="p">:</span>
            <span class="n">proposal</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;sell&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">contract_id</span><span class="p">,</span>  
                <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">0</span>
            <span class="p">}</span>
        <span class="c1"># To ensure this class isn&#39;t used to do price proposals without a defined contract type</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">proposal_type</span> <span class="o">==</span> <span class="s1">&#39;price_proposal&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Use a Subclass to use this method&#39;</span><span class="p">)</span>
                
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">proposal</span><span class="p">)</span></div>


<div class="viewcode-block" id="Product._send">
<a class="viewcode-back" href="../index.html#mvapi.Product._send">[docs]</a>
    <span class="k">def</span> <span class="nf">_send</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sends the current proposal to the WebSocket and handles the response.</span>

<span class="sd">        This method ensures the WebSocket connection is active, sends the proposal created by `_proposal()`, </span>
<span class="sd">        and processes the response received from the WebSocket.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            `True` if the message was successfully sent and a response was handled, otherwise `False`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_connection</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_proposal</span><span class="p">())</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recv_msg_handler</span><span class="p">()</span></div>

        
<div class="viewcode-block" id="Product.send_message">
<a class="viewcode-back" href="../index.html#mvapi.Product.send_message">[docs]</a>
    <span class="k">def</span> <span class="nf">send_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sends a user-defined JSON message to the WebSocket and returns the response.</span>

<span class="sd">        This method ensures the WebSocket connection is active, sends the provided message, </span>
<span class="sd">        and processes the response. If an exception occurs, it retries sending the message.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        message : dict</span>
<span class="sd">            The JSON message to send to the WebSocket.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            The response received from the WebSocket.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_connection</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">message</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">recv</span><span class="p">())</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_msg</span> <span class="o">=</span> <span class="n">response</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span></div>

    
<div class="viewcode-block" id="Product.stream">
<a class="viewcode-back" href="../index.html#mvapi.Product.stream">[docs]</a>
    <span class="k">def</span> <span class="nf">stream</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Streams data from the WebSocket.</span>

<span class="sd">        This method sends a proposal to the WebSocket and processes the incoming messages. </span>
<span class="sd">        It handles the subscription to updates and stops streaming if the contract is closed or </span>
<span class="sd">        a keyboard interrupt is detected.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            Returns 1 upon successful completion of the streaming process.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_connection</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_proposal</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_recv_msg_handler</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_closed</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Contract cannot be sold&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subscribe</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_send</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subscription_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_msg</span><span class="p">[</span><span class="s1">&#39;subscription&#39;</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_recv_msg_handler</span><span class="p">()</span>
                    <span class="n">display</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_msg</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Keyboard Interrupt to stop streaming&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_closed</span><span class="p">():</span>
                        <span class="k">break</span>
            <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s2">&quot;forget&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">subscription_id</span><span class="p">}))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_recv_msg_handler</span><span class="p">()</span>
        <span class="k">return</span> <span class="mi">1</span></div>

        
<div class="viewcode-block" id="Product.price_proposal">
<a class="viewcode-back" href="../index.html#mvapi.Product.price_proposal">[docs]</a>
    <span class="k">def</span> <span class="nf">price_proposal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">random</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">buy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Requests a price proposal from the WebSocket.</span>

<span class="sd">        This method sets the proposal type to &#39;price_proposal&#39; and updates attributes based on </span>
<span class="sd">        the provided arguments. It sends the proposal and optionally displays the response if </span>
<span class="sd">        the `buy` parameter is `False`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        random : bool, optional</span>
<span class="sd">            Whether to randomize attributes before sending the proposal. Defaults to `False`.</span>
<span class="sd">        buy : bool, optional</span>
<span class="sd">            Whether to buy the contract immediately after receiving the proposal. Defaults to `False`.</span>
<span class="sd">        take_profit : float, optional</span>
<span class="sd">            The take profit value for the proposal. Defaults to 0.</span>
<span class="sd">        stop_loss : float, optional</span>
<span class="sd">            The stop loss value for the proposal. Defaults to 0.</span>
<span class="sd">        **kwargs : keyword arguments</span>
<span class="sd">            Additional attributes to set for the proposal.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            `True` if the proposal was successfully sent and a response was received; otherwise, `False`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">random</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">randomise_attributes</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_attributes</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proposal_type</span> <span class="o">=</span> <span class="s1">&#39;price_proposal&#39;</span>
        <span class="n">success</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_send</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">buy</span> <span class="ow">and</span> <span class="n">success</span><span class="p">:</span>
            <span class="n">display</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">success</span></div>

    
<div class="viewcode-block" id="Product.buy_contract">
<a class="viewcode-back" href="../index.html#mvapi.Product.buy_contract">[docs]</a>
    <span class="k">def</span> <span class="nf">buy_contract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">runs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">random</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attempts to buy a contract.</span>

<span class="sd">        This method tries to buy a contract for a specified number of `runs`. It randomizes </span>
<span class="sd">        attributes if required and sends a price proposal with the `buy` parameter set to `True`. </span>
<span class="sd">        Upon success, it updates the `proposal_id` and sends a buy contract proposal. The contract </span>
<span class="sd">        ID is then appended to the `contract_ids` list.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        runs : int, optional</span>
<span class="sd">            The number of contracts to attempt to buy. Defaults to 1.</span>
<span class="sd">        random : bool, optional</span>
<span class="sd">            Whether to randomize attributes before sending the proposal. Defaults to `False`.</span>
<span class="sd">        **kwargs : keyword arguments</span>
<span class="sd">            Additional attributes to set for the proposal.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">runs</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">random</span> <span class="ow">or</span> <span class="n">runs</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">randomise_attributes</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_attributes</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">price_proposal</span><span class="p">(</span><span class="n">buy</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">proposal_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_msg</span><span class="p">[</span><span class="s1">&#39;proposal&#39;</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">proposal_type</span> <span class="o">=</span> <span class="s1">&#39;buy_contract&#39;</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_send</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">contract_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_msg</span><span class="p">[</span><span class="s1">&#39;buy&#39;</span><span class="p">][</span><span class="s1">&#39;contract_id&#39;</span><span class="p">])</span>
                    <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">contract_proposal</span><span class="p">()</span></div>

        
<div class="viewcode-block" id="Product.contract_proposal">
<a class="viewcode-back" href="../index.html#mvapi.Product.contract_proposal">[docs]</a>
    <span class="k">def</span> <span class="nf">contract_proposal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contract_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">subscribe</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the contract proposal.</span>

<span class="sd">        This method retrieves the details of a contract using the provided `contract_id`. </span>
<span class="sd">        If no `contract_id` is provided, it uses the last saved contract ID. It sends a </span>
<span class="sd">        contract proposal message and optionally subscribes to updates based on the `subscribe` parameter. </span>
<span class="sd">        If `subscribe` is set to 1, it starts streaming the contract updates.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        contract_id : str, optional</span>
<span class="sd">            The ID of the contract to retrieve details for. If not provided, the last saved contract ID is used.</span>
<span class="sd">        subscribe : int, optional</span>
<span class="sd">            Whether to subscribe to updates for the contract. Defaults to 0 (no subscription). If set to 1, </span>
<span class="sd">            streaming of contract updates is initiated.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">contract_id</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">contract_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">contract_ids</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span> 
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No Contract ID saved.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">contract_id</span> <span class="o">=</span> <span class="n">contract_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proposal_type</span> <span class="o">=</span> <span class="s1">&#39;contract_proposal&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subscribe</span> <span class="o">=</span> <span class="n">subscribe</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subscribe</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_send</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">subscribe</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">()</span>
        <span class="n">display</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_msg</span><span class="p">)</span></div>

            
<div class="viewcode-block" id="Product.get_all_poc">
<a class="viewcode-back" href="../index.html#mvapi.Product.get_all_poc">[docs]</a>
    <span class="k">def</span> <span class="nf">get_all_poc</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves all open contract proposals.</span>

<span class="sd">        This method iterates through all contract IDs stored in `self.contract_ids` and retrieves the details </span>
<span class="sd">        for each open contract by calling the `contract_proposal` method with each contract ID.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">temp_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">contract_ids</span><span class="p">:</span>
            <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">contract_proposal</span><span class="p">(</span><span class="n">contract_id</span><span class="o">=</span><span class="n">temp_id</span><span class="p">)</span></div>

            
<div class="viewcode-block" id="Product.tick_history">
<a class="viewcode-back" href="../index.html#mvapi.Product.tick_history">[docs]</a>
    <span class="k">def</span> <span class="nf">tick_history</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">symbol</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;latest&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fetches historical tick data for the specified symbol.</span>

<span class="sd">        This method constructs a message to request historical tick data from the WebSocket API. It sends the </span>
<span class="sd">        request with parameters specifying the symbol, number of ticks to retrieve, and the end time.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        symbol : str, optional</span>
<span class="sd">            The symbol for which to retrieve tick history. If not provided, defaults to `self.symbol`.</span>
<span class="sd">        count : int, optional</span>
<span class="sd">            The number of ticks to retrieve. Defaults to 1.</span>
<span class="sd">        end : str, optional</span>
<span class="sd">            The end time for the tick data. Defaults to &#39;latest&#39;.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            The response from the WebSocket API containing the tick history data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">temp_msg</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;ticks_history&quot;</span><span class="p">:</span> <span class="n">symbol</span> <span class="k">if</span> <span class="n">symbol</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbol</span><span class="p">,</span>
            <span class="s2">&quot;adjust_start_time&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">count</span><span class="p">,</span>
            <span class="s2">&quot;end&quot;</span><span class="p">:</span> <span class="n">end</span><span class="p">,</span>
            <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;style&quot;</span><span class="p">:</span> <span class="s2">&quot;ticks&quot;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">temp_msg</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="Product._check_connection">
<a class="viewcode-back" href="../index.html#mvapi.Product._check_connection">[docs]</a>
    <span class="k">def</span> <span class="nf">_check_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks the WebSocket connection by sending a ping message and waiting for a response. If an exception </span>
<span class="sd">        occurs (indicating the connection is closed), it attempts to reconnect by creating a new WebSocket </span>
<span class="sd">        connection.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Send a ping message</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s2">&quot;ping&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}))</span>
            <span class="c1"># Receive a response</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Connection Closed, Reconnecting&#39;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
            <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_ws</span><span class="p">()</span></div>

            
<div class="viewcode-block" id="Product._check_closed">
<a class="viewcode-back" href="../index.html#mvapi.Product._check_closed">[docs]</a>
    <span class="k">def</span> <span class="nf">_check_closed</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if the contract has expired or been sold.</span>

<span class="sd">        This method inspects the latest message received from the WebSocket API to determine if the contract is </span>
<span class="sd">        expired or sold.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            1 if the contract is expired or sold, otherwise 0.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_msg</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;is_expired&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_msg</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;is_sold&#39;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="k">return</span> <span class="mi">0</span></div>

            
<div class="viewcode-block" id="Product.sell_contract">
<a class="viewcode-back" href="../index.html#mvapi.Product.sell_contract">[docs]</a>
    <span class="k">def</span> <span class="nf">sell_contract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contract_id</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attempts to sell a contract by its ID.</span>

<span class="sd">        This method sets the proposal type to &#39;sell_contract&#39; and sends the proposal to the WebSocket API. </span>
<span class="sd">        It handles the response and displays the result. If the proposal is unsuccessful, it retrieves the </span>
<span class="sd">        contract proposal details again.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        contract_id : str, optional</span>
<span class="sd">            The ID of the contract to sell. If not provided, the last saved contract ID is used.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">contract_id</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">contract_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">contract_ids</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">contract_id</span> <span class="o">=</span> <span class="n">contract_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proposal_type</span> <span class="o">=</span> <span class="s1">&#39;sell_contract&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_send</span><span class="p">():</span>
            <span class="n">display</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_msg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">contract_proposal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contract_id</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">contract_proposal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contract_id</span><span class="p">)</span></div>

            
<div class="viewcode-block" id="Product.sell_all_contracts">
<a class="viewcode-back" href="../index.html#mvapi.Product.sell_all_contracts">[docs]</a>
    <span class="k">def</span> <span class="nf">sell_all_contracts</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sells all contracts in the contract IDs list.</span>

<span class="sd">        This method iterates over the list of contract IDs, and attempts to sell each contract one by one</span>
<span class="sd">        by calling the `sell_contract` method</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span> 
        <span class="k">for</span> <span class="n">temp_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">contract_ids</span><span class="p">:</span>
            <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sell_contract</span><span class="p">(</span><span class="n">contract_id</span><span class="o">=</span><span class="n">temp_id</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="Product.create_ws">
<a class="viewcode-back" href="../index.html#mvapi.Product.create_ws">[docs]</a>
    <span class="k">def</span> <span class="nf">create_ws</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a WebSocket connection to the specified endpoint.</span>

<span class="sd">        This method initializes the WebSocket connection using the endpoint URL. It sets the `ws` attribute </span>
<span class="sd">        to the WebSocket connection object.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ws</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ws</span> <span class="o">=</span> <span class="n">websocket</span><span class="o">.</span><span class="n">create_connection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endpoint</span><span class="p">)</span></div>


<div class="viewcode-block" id="Product.authorise">
<a class="viewcode-back" href="../index.html#mvapi.Product.authorise">[docs]</a>
    <span class="k">def</span> <span class="nf">authorise</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Authorizes the WebSocket connection using the provided API token.</span>

<span class="sd">        This method sends an authorization request with the API token and checks the response to determine </span>
<span class="sd">        if the authorization was successful.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            1 if authorization is successful, otherwise 0.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_connection</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s2">&quot;authorize&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_token</span><span class="p">}))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recv_msg_handler</span><span class="p">():</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span></div>

    
<div class="viewcode-block" id="Product._recv_msg_handler">
<a class="viewcode-back" href="../index.html#mvapi.Product._recv_msg_handler">[docs]</a>
    <span class="k">def</span> <span class="nf">_recv_msg_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles the reception of messages from the WebSocket.</span>

<span class="sd">        This method attempts to receive and process messages from the WebSocket. It handles errors and retries </span>
<span class="sd">        sending the request if necessary. Specific errors are managed with different strategies, such as reauthorizing </span>
<span class="sd">        or adjusting contract parameters based on the error details.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            1 if the message is received and processed successfully, otherwise 0.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_msg</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">retry</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_send</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_msg</span><span class="p">)</span>
        <span class="n">error_handle_flag</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="s1">&#39;error&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_msg</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">retry</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_msg</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span>
            <span class="k">match</span> <span class="n">error</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]:</span>
                <span class="k">case</span> <span class="s1">&#39;InvalidToken&#39;</span> <span class="o">|</span> <span class="s1">&#39;OpenPositionLimitExceeded&#39;</span> <span class="o">|</span> <span class="s1">&#39;InvalidSellContractProposal&#39;</span> <span class="o">|</span> <span class="s1">&#39;InvalidtoSell&#39;</span> <span class="o">|</span> <span class="s1">&#39;InvalidOfferings&#39;</span><span class="p">:</span>
                    <span class="n">display</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
                    <span class="n">error_handle_flag</span> <span class="o">=</span> <span class="mi">1</span> 
                <span class="k">case</span> <span class="s1">&#39;AuthorizationRequired&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">authorise</span><span class="p">():</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">retry</span> <span class="o">+=</span><span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">display</span><span class="p">(</span><span class="s1">&#39;Auth failed&#39;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
                        <span class="n">error_handle_flag</span> <span class="o">=</span> <span class="mi">1</span> 
                <span class="k">case</span> <span class="s1">&#39;OfferingsValidationError&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">error</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Number of ticks must be between 5 and 10.&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">11</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">error</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Trading is not offered for this asset.&#39;</span><span class="p">:</span> 
                        <span class="bp">self</span><span class="o">.</span><span class="n">symbol</span> <span class="o">=</span> <span class="s1">&#39;R_100&#39;</span>        
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">display</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
                        <span class="n">error_handle_flag</span> <span class="o">=</span> <span class="mi">1</span> 
                <span class="k">case</span> <span class="s1">&#39;ContractBuyValidationError&#39;</span> <span class="o">|</span> <span class="s1">&#39;OfferingsValidationFailure&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s1">&#39;message&#39;</span> <span class="ow">in</span> <span class="n">error</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="n">error</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;This trade is temporarily unavailable.&#39;</span><span class="p">:</span>
                        <span class="n">display</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
                        <span class="n">error_handle_flag</span> <span class="o">=</span> <span class="mi">1</span> 
                    <span class="k">elif</span> <span class="n">error</span><span class="p">[</span><span class="s1">&#39;details&#39;</span><span class="p">][</span><span class="s1">&#39;field&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;barrier&#39;</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span> 
                            <span class="bp">self</span><span class="o">.</span><span class="n">strike</span> <span class="o">=</span> <span class="n">error</span><span class="p">[</span><span class="s1">&#39;details&#39;</span><span class="p">][</span><span class="s1">&#39;barrier_choices&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                            <span class="c1"># self.strike = random.choice(error[&#39;details&#39;][&#39;barrier_choices&#39;])</span>
                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">strike</span> <span class="o">=</span> <span class="s1">&#39;1000&#39;</span>
                    <span class="k">elif</span> <span class="n">error</span><span class="p">[</span><span class="s1">&#39;details&#39;</span><span class="p">][</span><span class="s1">&#39;field&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;amount&#39;</span><span class="p">:</span>
                        <span class="c1"># display(self.last_msg)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">stake</span> <span class="o">=</span> <span class="n">error</span><span class="p">[</span><span class="s1">&#39;details&#39;</span><span class="p">][</span><span class="s1">&#39;min_stake&#39;</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="n">error</span><span class="p">[</span><span class="s1">&#39;details&#39;</span><span class="p">][</span><span class="s1">&#39;field&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;duration&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">error</span><span class="p">[</span><span class="s1">&#39;details&#39;</span><span class="p">][</span><span class="s1">&#39;field&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;payout_per_point&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">payout_per_point</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">error</span><span class="p">[</span><span class="s1">&#39;details&#39;</span><span class="p">][</span><span class="s1">&#39;payout_per_point_choices&#39;</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">display</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
                        <span class="n">error_handle_flag</span> <span class="o">=</span> <span class="mi">1</span> 
                <span class="k">case</span> <span class="s1">&#39;InvalidContractProposal&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">buy_contract</span><span class="p">()</span>
                <span class="k">case</span> <span class="s1">&#39;ContractCreationFailure&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">randomise_attributes</span><span class="p">()</span>
                <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span> <span class="c1"># Default case</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Undefined Error&#39;</span><span class="p">)</span>
                    <span class="n">display</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
                    <span class="n">error_handle_flag</span> <span class="o">=</span> <span class="mi">1</span> 
            <span class="k">if</span> <span class="n">error_handle_flag</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">retry</span> <span class="o">&gt;</span> <span class="mi">8</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">retry</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">return</span> <span class="mi">0</span>                
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">retry</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span> 
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_send</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">retry</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">return</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">retry</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">return</span> <span class="mi">1</span></div>
</div>


<div class="viewcode-block" id="accu_barriers">
<a class="viewcode-back" href="../index.html#mvapi.accu_barriers">[docs]</a>
<span class="k">def</span> <span class="nf">accu_barriers</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determines if the higher, lower, and barrier distance of the current spot are accurate for an accumulator contract.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    prop : dict</span>
<span class="sd">        The proposal dictionary containing contract details and spot information.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple</span>
<span class="sd">        A tuple containing the calculated high barrier, low barrier, barrier distance, and a boolean indicating </span>
<span class="sd">        if the barriers and distance are accurate.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">contract_details</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal&#39;</span><span class="p">][</span><span class="s1">&#39;contract_details&#39;</span><span class="p">]</span>
    <span class="n">spot</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal&#39;</span><span class="p">][</span><span class="s1">&#39;spot&#39;</span><span class="p">]</span>
    <span class="n">symbol</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;echo_req&#39;</span><span class="p">][</span><span class="s1">&#39;symbol&#39;</span><span class="p">]</span>
    <span class="n">tick_size_barrier</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">[</span><span class="n">symbol</span><span class="p">][</span><span class="s1">&#39;accu&#39;</span><span class="p">][</span><span class="s1">&#39;barrier&#39;</span><span class="p">][</span><span class="nb">str</span><span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;echo_req&#39;</span><span class="p">][</span><span class="s1">&#39;growth_rate&#39;</span><span class="p">])]</span>

    <span class="n">high_bar</span><span class="p">,</span> <span class="n">low_bar</span><span class="p">,</span> <span class="n">bar_dist</span> <span class="o">=</span> \
        <span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">spot</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">tick_size_barrier</span><span class="p">),</span> <span class="n">symbols</span><span class="p">[</span><span class="n">symbol</span><span class="p">][</span><span class="s1">&#39;precision&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)),</span> \
        <span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">spot</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">tick_size_barrier</span><span class="p">),</span> <span class="n">symbols</span><span class="p">[</span><span class="n">symbol</span><span class="p">][</span><span class="s1">&#39;precision&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)),</span> \
        <span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">spot</span> <span class="o">*</span> <span class="p">(</span><span class="n">tick_size_barrier</span><span class="p">),</span> <span class="n">symbols</span><span class="p">[</span><span class="n">symbol</span><span class="p">][</span><span class="s1">&#39;precision&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">pass_fail</span> <span class="o">=</span>\
    <span class="nb">abs</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">contract_details</span><span class="p">[</span><span class="s1">&#39;high_barrier&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="n">high_bar</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">10</span><span class="o">**</span><span class="n">symbols</span><span class="p">[</span><span class="n">symbol</span><span class="p">][</span><span class="s1">&#39;precision&#39;</span><span class="p">]</span> <span class="ow">and</span> \
    <span class="nb">abs</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">contract_details</span><span class="p">[</span><span class="s1">&#39;low_barrier&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="n">low_bar</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">10</span><span class="o">**</span><span class="n">symbols</span><span class="p">[</span><span class="n">symbol</span><span class="p">][</span><span class="s1">&#39;precision&#39;</span><span class="p">]</span> <span class="ow">and</span> \
    <span class="nb">abs</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">contract_details</span><span class="p">[</span><span class="s1">&#39;barrier_spot_distance&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="n">bar_dist</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">10</span><span class="o">**</span><span class="n">symbols</span><span class="p">[</span><span class="n">symbol</span><span class="p">][</span><span class="s1">&#39;precision&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">high_bar</span><span class="p">,</span> <span class="n">low_bar</span><span class="p">,</span> <span class="n">bar_dist</span><span class="p">,</span> <span class="n">pass_fail</span></div>


<div class="viewcode-block" id="accu_payout">
<a class="viewcode-back" href="../index.html#mvapi.accu_payout">[docs]</a>
<span class="k">def</span> <span class="nf">accu_payout</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the payout, match flag, and close flag for an accumulator contract.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    prop : dict</span>
<span class="sd">        The proposal open contract dictionary containing contract details, spot information, and other related data.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple</span>
<span class="sd">        A tuple containing the calculated payout, a boolean indicating if the payout matches the bid price, </span>
<span class="sd">        and a string indicating the close flag status.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">symbol</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;underlying&#39;</span><span class="p">]</span>
    <span class="n">is_r</span> <span class="o">=</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;R&#39;</span><span class="p">),</span> <span class="n">symbol</span><span class="p">)</span> <span class="k">else</span> <span class="mi">1</span>
    <span class="n">ctype</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;contract_type&#39;</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">spot</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;exit_tick&#39;</span><span class="p">]</span> 
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">spot</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;current_spot&#39;</span><span class="p">]</span>
    <span class="n">barrier</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;barrier&#39;</span><span class="p">])</span>
    <span class="n">bid_price</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;bid_price&#39;</span><span class="p">]</span>
    
    <span class="n">ppp</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;display_number_of_contracts&#39;</span><span class="p">])</span>
    <span class="n">shortcode</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;shortcode&#39;</span><span class="p">]</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">get_sigma</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;exit_tick_time&#39;</span> <span class="ow">in</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;exit_tick_time&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;expiry_time&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ctype</span> <span class="o">==</span> <span class="s1">&#39;TURBOSLONG&#39;</span> <span class="ow">and</span> <span class="n">spot</span> <span class="o">&lt;=</span> <span class="n">barrier</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">ctype</span> <span class="o">==</span> <span class="s1">&#39;TURBOSSHORT&#39;</span> <span class="ow">and</span> <span class="n">spot</span> <span class="o">&gt;=</span> <span class="n">barrier</span><span class="p">):</span>
            <span class="n">payout</span><span class="p">,</span> <span class="n">close_flag</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;ko&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">payout</span><span class="p">,</span> <span class="n">close_flag</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">spot</span> <span class="o">-</span> <span class="n">barrier</span><span class="p">)</span> <span class="o">*</span> <span class="n">ppp</span><span class="p">,</span> <span class="s1">&#39;expired&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">comm</span> <span class="o">=</span> <span class="s1">&#39;down_&#39;</span><span class="k">if</span> <span class="n">ctype</span> <span class="o">==</span> <span class="s1">&#39;TURBOSLONG&#39;</span> <span class="k">else</span> <span class="s1">&#39;up_&#39;</span>
        <span class="n">comm</span> <span class="o">+=</span> <span class="s1">&#39;t&#39;</span> <span class="k">if</span> <span class="s1">&#39;T&#39;</span> <span class="ow">in</span> <span class="n">shortcode</span><span class="p">[</span><span class="mi">11</span><span class="p">:]</span> <span class="k">else</span> <span class="s1">&#39;i&#39;</span> <span class="k">if</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;is_intraday&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="s1">&#39;d&#39;</span>
        <span class="n">comm</span> <span class="o">=</span> <span class="s1">&#39;tick_comm_&#39;</span> <span class="o">+</span> <span class="n">comm</span>
        <span class="n">comm</span> <span class="o">=</span> <span class="n">BO</span><span class="p">[</span><span class="s1">&#39;turbos&#39;</span><span class="p">][</span><span class="n">comm</span><span class="p">][</span><span class="n">symbol</span><span class="p">]</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">is_r</span><span class="o">/</span><span class="mi">365</span><span class="o">/</span><span class="mi">86400</span><span class="p">)</span>
        <span class="n">payout</span><span class="p">,</span> <span class="n">close_flag</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span> <span class="p">(</span><span class="n">spot</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">comm</span><span class="p">)</span> <span class="o">-</span> <span class="n">barrier</span><span class="p">)</span> <span class="o">*</span> <span class="n">ppp</span> <span class="k">if</span> <span class="n">ctype</span> <span class="o">==</span> <span class="s1">&#39;TURBOSLONG&#39;</span> <span class="k">else</span> <span class="p">(</span><span class="n">barrier</span> <span class="o">-</span> <span class="n">spot</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">comm</span><span class="p">))</span> <span class="o">*</span> <span class="n">ppp</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="s1">&#39;sold&#39;</span> <span class="k">if</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;is_sold&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="s1">&#39;bid&#39;</span>
    <span class="n">match_flag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">payout</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="n">bid_price</span>
    <span class="k">return</span> <span class="n">payout</span><span class="p">,</span> <span class="n">match_flag</span><span class="p">,</span> <span class="n">close_flag</span></div>


<div class="viewcode-block" id="Accumulator">
<a class="viewcode-back" href="../index.html#mvapi.Accumulator">[docs]</a>
<span class="k">class</span> <span class="nc">Accumulator</span><span class="p">(</span><span class="n">Product</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class to represent an Accumulator product, inheriting from the Product class.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        species (str): The type of the product, &#39;Accumulator&#39;.</span>
<span class="sd">        contract_type (str): The type of contract, default is &#39;ACCU&#39;.</span>
<span class="sd">        growth_rate (float): The growth rate of the accumulator, default is 0.05.</span>

<span class="sd">    Methods:</span>
<span class="sd">        randomise_attributes(): Randomises the attributes of the Accumulator instance.</span>
<span class="sd">        _proposal(): Generates a proposal specific to the Accumulator product.</span>
<span class="sd">        check_barrier(runs=0, show=False): Checks barrier conditions for the given number of runs.</span>
<span class="sd">        check_payout(runs=0, show=False): Checks payout conditions for the given number of runs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">species</span> <span class="o">=</span> <span class="s2">&quot;Accumulator&quot;</span>
    
<div class="viewcode-block" id="Accumulator.__init__">
<a class="viewcode-back" href="../index.html#mvapi.Accumulator.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes an Accumulator instance.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        **kwargs : dict</span>
<span class="sd">            Keyword arguments to initialize the instance attributes. Includes &#39;growth_rate&#39;, which defaults to 0.05.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contract_type</span> <span class="o">=</span> <span class="s1">&#39;ACCU&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">growth_rate</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;growth_rate&#39;</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span></div>


<div class="viewcode-block" id="Accumulator.randomise_attributes">
<a class="viewcode-back" href="../index.html#mvapi.Accumulator.randomise_attributes">[docs]</a>
    <span class="k">def</span> <span class="nf">randomise_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Randomises the attributes of the Accumulator instance.</span>

<span class="sd">        Sets the symbol to a random choice from available symbols, </span>
<span class="sd">        the stake to a random value within the defined range, and</span>
<span class="sd">        the growth rate to a random value from a predefined list.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symbol</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">symbols</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stake</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">BO</span><span class="p">[</span><span class="s1">&#39;accumulators&#39;</span><span class="p">][</span><span class="s1">&#39;max_stake&#39;</span><span class="p">][</span><span class="s1">&#39;USD&#39;</span><span class="p">]),</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">growth_rate</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.02</span><span class="p">,</span><span class="mf">0.03</span><span class="p">,</span><span class="mf">0.04</span><span class="p">,</span><span class="mf">0.05</span><span class="p">])</span></div>



<div class="viewcode-block" id="Accumulator._proposal">
<a class="viewcode-back" href="../index.html#mvapi.Accumulator._proposal">[docs]</a>
    <span class="k">def</span> <span class="nf">_proposal</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates a proposal specific to the Accumulator product.</span>

<span class="sd">        Creates a proposal dictionary based on the current instance attributes.</span>
<span class="sd">        Includes &#39;take_profit&#39; and &#39;stop_loss&#39; if they are set. </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            The JSON-encoded proposal.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">proposal</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">proposal_type</span> <span class="o">==</span> <span class="s1">&#39;price_proposal&#39;</span><span class="p">:</span>
            <span class="n">proposal</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;proposal&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;amount&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">stake</span><span class="p">,</span>
                <span class="s2">&quot;basis&quot;</span><span class="p">:</span> <span class="s2">&quot;stake&quot;</span><span class="p">,</span>
                <span class="s2">&quot;contract_type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">contract_type</span><span class="p">,</span>
                <span class="s2">&quot;currency&quot;</span><span class="p">:</span> <span class="s2">&quot;USD&quot;</span><span class="p">,</span>
                <span class="s2">&quot;symbol&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbol</span><span class="p">,</span>
                <span class="s1">&#39;growth_rate&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">growth_rate</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">take_profit</span><span class="p">:</span>
                <span class="n">insert_dict</span><span class="p">(</span><span class="n">proposal</span><span class="p">,</span> <span class="s1">&#39;limit_order&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;take_profit&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">take_profit</span><span class="p">})</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_loss</span><span class="p">:</span>
                <span class="n">insert_dict</span><span class="p">(</span><span class="n">proposal</span><span class="p">,</span> <span class="s1">&#39;limit_order&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;stop_loss&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_loss</span><span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_proposal</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">proposal</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="Accumulator.check_barrier">
<a class="viewcode-back" href="../index.html#mvapi.Accumulator.check_barrier">[docs]</a>
    <span class="k">def</span> <span class="nf">check_barrier</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">runs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">show</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks barrier conditions for all saved proposals and the given number of runs.</span>

<span class="sd">        Randomises attributes and generates price proposals for the specified number of runs.</span>
<span class="sd">        Analyzes messages to check if barriers are accurate and displays the results.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        runs : int</span>
<span class="sd">            The number of times to run the check.</span>
<span class="sd">        show : bool</span>
<span class="sd">            If True, displays messages with failed barrier checks.</span>
<span class="sd">        **kwargs : dict</span>
<span class="sd">            Additional keyword arguments for setting attributes.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">runs</span><span class="p">):</span>
            <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">randomise_attributes</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_attributes</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">price_proposal</span><span class="p">()</span>
        <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accu_barrier_stats</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;stat&#39;</span><span class="p">:</span> <span class="s1">&#39;accu_barrier_stats&#39;</span><span class="p">,</span> <span class="s1">&#39;cases&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;pass&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;fail&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>        
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;msg_type&#39;</span> <span class="ow">in</span> <span class="n">item</span> <span class="ow">and</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;msg_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;proposal&#39;</span> <span class="ow">and</span> <span class="s1">&#39;error&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
                <span class="n">temp_dict</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;high_barrier&#39;</span><span class="p">],</span> <span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;low_barrier&#39;</span><span class="p">],</span> <span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;barrier_spot_distance&#39;</span><span class="p">],</span> <span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;barrier_check&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">accu_barriers</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="n">insert_dict</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="s1">&#39;mv&#39;</span><span class="p">,</span> <span class="n">temp_dict</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">accu_barrier_stats</span><span class="p">[</span><span class="s1">&#39;cases&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;mv&#39;</span><span class="p">][</span><span class="s1">&#39;barrier_check&#39;</span><span class="p">]:</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">accu_barrier_stats</span><span class="p">[</span><span class="s1">&#39;pass&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">accu_barrier_stats</span><span class="p">[</span><span class="s1">&#39;fail&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>                
                <span class="k">if</span> <span class="ow">not</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;mv&#39;</span><span class="p">][</span><span class="s1">&#39;barrier_check&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">show</span><span class="p">:</span>
                    <span class="n">display</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                     
        <span class="n">display</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">accu_barrier_stats</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="Accumulator.check_payout">
<a class="viewcode-back" href="../index.html#mvapi.Accumulator.check_payout">[docs]</a>
    <span class="k">def</span> <span class="nf">check_payout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">runs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">show</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        to check payout obviously /s</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">runs</span><span class="p">):</span>
            <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">buy_contract</span><span class="p">(</span><span class="n">random</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_all_poc</span><span class="p">()</span>
        <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;cases&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;pass&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;fail&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
            <span class="s1">&#39;ko&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;cases&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;pass&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;fail&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
            <span class="s1">&#39;sold&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;cases&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;pass&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;fail&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
            <span class="s1">&#39;bid&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;cases&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;pass&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;fail&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;msg_type&#39;</span> <span class="ow">in</span> <span class="n">item</span> <span class="ow">and</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;msg_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;proposal_open_contract&#39;</span> <span class="ow">and</span> <span class="s1">&#39;error&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
                <span class="n">temp_dict</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;payout&#39;</span><span class="p">],</span> <span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">],</span> <span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;close_flag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">accu_payout</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> 
                <span class="n">insert_dict</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="s1">&#39;mv&#39;</span><span class="p">,</span> <span class="n">temp_dict</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">][</span><span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;close_flag&#39;</span><span class="p">]][</span><span class="s1">&#39;cases&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="s1">&#39;cases&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;mv&#39;</span><span class="p">][</span><span class="s1">&#39;payout_check&#39;</span><span class="p">]:</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">][</span><span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;close_flag&#39;</span><span class="p">]][</span><span class="s1">&#39;pass&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="s1">&#39;pass&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">][</span><span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;close_flag&#39;</span><span class="p">]][</span><span class="s1">&#39;fail&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>  
                    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="s1">&#39;fail&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;mv&#39;</span><span class="p">][</span><span class="s1">&#39;payout_check&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">show</span><span class="p">:</span>
                    <span class="n">display</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">stats_payout</span> <span class="o">=</span> <span class="n">dict_to_df</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">],</span> <span class="s1">&#39;Payout&#39;</span><span class="p">)</span></div>
</div>


<div class="viewcode-block" id="vanilla_barriers">
<a class="viewcode-back" href="../index.html#mvapi.vanilla_barriers">[docs]</a>
<span class="k">def</span> <span class="nf">vanilla_barriers</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate expected barrier choices for vanillas based on given json&quot;&quot;&quot;</span>
    <span class="n">spot</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal&#39;</span><span class="p">][</span><span class="s1">&#39;spot&#39;</span><span class="p">]</span>
    <span class="n">symbol</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;echo_req&#39;</span><span class="p">][</span><span class="s1">&#39;symbol&#39;</span><span class="p">]</span>
    <span class="n">duration</span> <span class="o">=</span> <span class="p">[</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal&#39;</span><span class="p">][</span><span class="s1">&#39;date_start&#39;</span><span class="p">],</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal&#39;</span><span class="p">][</span><span class="s1">&#39;date_expiry&#39;</span><span class="p">]]</span>
    <span class="n">duration_unit</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;echo_req&#39;</span><span class="p">][</span><span class="s1">&#39;duration_unit&#39;</span><span class="p">]</span>
    <span class="n">digits</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">[</span><span class="n">symbol</span><span class="p">][</span><span class="s1">&#39;digits&#39;</span><span class="p">]</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(\d+)[^\d]*$&#39;</span><span class="p">,</span> <span class="n">symbol</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="mi">100</span>
    <span class="n">n_digits</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">spot</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">60</span> <span class="o">/</span> <span class="mi">365</span> <span class="o">/</span> <span class="mi">86400</span><span class="p">)),</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">spot</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">spot</span> <span class="o">/</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="n">n_digits</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="n">n_digits</span>
    <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">duration</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">duration</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">/</span> <span class="mi">365</span> <span class="o">/</span> <span class="mi">86400</span>    
    <span class="k">if</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="mi">5</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">/</span> <span class="mi">365</span> <span class="o">/</span> <span class="mi">86400</span> <span class="ow">and</span> <span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">symbol</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">-=</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">365</span> <span class="o">/</span> <span class="mi">86400</span>        
    <span class="k">if</span> <span class="n">duration_unit</span> <span class="o">!=</span> <span class="s1">&#39;d&#39;</span><span class="p">:</span>
        <span class="n">deltas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">BO</span><span class="p">[</span><span class="s1">&#39;vanillas&#39;</span><span class="p">][</span><span class="s1">&#39;delta_config&#39;</span><span class="p">])</span>
        <span class="n">real_strikes</span> <span class="o">=</span> <span class="n">spot</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="n">sigma</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">t</span> <span class="o">-</span> <span class="p">(</span><span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">deltas</span><span class="p">)))</span>
        <span class="n">displayed_barriers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">((</span><span class="n">real_strikes</span> <span class="o">-</span> <span class="n">spot</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">digits</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">digits</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">temp_barriers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">displayed_barriers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">central_strike</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">spot</span> <span class="o">/</span> <span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="n">n_digits</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="n">n_digits</span><span class="p">)</span>
        <span class="n">max_strike</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">spot</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="n">sigma</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">t</span> <span class="o">-</span> <span class="p">(</span><span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">0.1</span><span class="p">))))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="n">n_digits</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="n">n_digits</span><span class="p">)</span>
        <span class="n">min_strike</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="n">spot</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="n">sigma</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">t</span> <span class="o">-</span> <span class="p">(</span><span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">0.9</span><span class="p">))))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="n">n_digits</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="n">n_digits</span><span class="p">)</span>
        <span class="n">strike_step_1</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="n">central_strike</span> <span class="o">-</span> <span class="n">min_strike</span><span class="p">)</span> <span class="o">/</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span>
        <span class="n">strike_step_2</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="n">max_strike</span> <span class="o">-</span> <span class="n">central_strike</span><span class="p">)</span> <span class="o">/</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span>         
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
            <span class="n">temp_barriers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">min_strike</span> <span class="o">+</span> <span class="n">strike_step_1</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span>            
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
            <span class="n">temp_barriers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">central_strike</span> <span class="o">+</span> <span class="n">strike_step_2</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span>            
        <span class="n">temp_barriers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">max_strike</span><span class="p">)</span>        
        <span class="k">for</span> <span class="n">strike</span> <span class="ow">in</span> <span class="n">temp_barriers</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">strike</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">displayed_barriers</span><span class="p">:</span>
                <span class="n">displayed_barriers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">strike</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">displayed_barriers</span></div>


<div class="viewcode-block" id="vanilla_ppp_ask">
<a class="viewcode-back" href="../index.html#mvapi.vanilla_ppp_ask">[docs]</a>
<span class="k">def</span> <span class="nf">vanilla_ppp_ask</span> <span class="p">(</span><span class="n">prop</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate expected payout per point (ppp) for a vanilla contract based on the given json&quot;&quot;&quot;</span>    
    <span class="n">spot</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal&#39;</span><span class="p">][</span><span class="s1">&#39;spot&#39;</span><span class="p">]</span>
    <span class="n">strike</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal&#39;</span><span class="p">][</span><span class="s1">&#39;contract_details&#39;</span><span class="p">][</span><span class="s1">&#39;barrier&#39;</span><span class="p">])</span>      
    <span class="n">number_of_contracts</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal&#39;</span><span class="p">][</span><span class="s1">&#39;display_number_of_contracts&#39;</span><span class="p">]</span>
    <span class="n">api_ppp</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal&#39;</span><span class="p">][</span><span class="s1">&#39;display_number_of_contracts&#39;</span><span class="p">])</span>
    <span class="n">symbol</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;echo_req&#39;</span><span class="p">][</span><span class="s1">&#39;symbol&#39;</span><span class="p">]</span>
    <span class="n">r</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="s1">&#39;pricing_args&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal&#39;</span><span class="p">][</span><span class="s1">&#39;pricing_args&#39;</span><span class="p">][</span><span class="s1">&#39;discount_rate&#39;</span><span class="p">]</span>
    <span class="n">contract_type</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;echo_req&#39;</span><span class="p">][</span><span class="s1">&#39;contract_type&#39;</span><span class="p">]</span>
    <span class="n">duration</span> <span class="o">=</span> <span class="p">[</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal&#39;</span><span class="p">][</span><span class="s1">&#39;date_start&#39;</span><span class="p">],</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal&#39;</span><span class="p">][</span><span class="s1">&#39;date_expiry&#39;</span><span class="p">]]</span>
    <span class="n">stake</span> <span class="o">=</span> <span class="n">get_stake</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
    <span class="n">vol_charge</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">BO</span><span class="p">[</span><span class="s1">&#39;vanillas&#39;</span><span class="p">][</span><span class="s1">&#39;vol_markup&#39;</span><span class="p">]</span>
    <span class="n">t</span> <span class="o">=</span> <span class="p">(</span> <span class="nb">int</span><span class="p">(</span><span class="n">duration</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">duration</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">)</span> <span class="o">/</span> <span class="mi">365</span> <span class="o">/</span> <span class="mi">86400</span>  
    <span class="k">if</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="mi">5</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">/</span> <span class="mi">365</span> <span class="o">/</span> <span class="mi">86400</span> <span class="ow">and</span> <span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">symbol</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">-=</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">365</span> <span class="o">/</span> <span class="mi">86400</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">get_sigma</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>
    <span class="n">spot_spread</span> <span class="o">=</span> <span class="n">BO</span><span class="p">[</span><span class="s1">&#39;vanillas&#39;</span><span class="p">][</span><span class="s1">&#39;spread_spot&#39;</span><span class="p">][</span><span class="n">symbol</span><span class="p">]</span>
    <span class="n">bs_markup</span> <span class="o">=</span> <span class="n">BO</span><span class="p">[</span><span class="s1">&#39;vanillas&#39;</span><span class="p">][</span><span class="s1">&#39;bs_markup&#39;</span><span class="p">]</span>        
    <span class="n">vol</span> <span class="o">=</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">vol_charge</span>
    <span class="n">d1</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">spot</span><span class="o">/</span><span class="n">strike</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">vol</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">vol</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
    <span class="n">d2</span> <span class="o">=</span> <span class="p">(</span><span class="n">d1</span> <span class="o">-</span> <span class="n">vol</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">contract_type</span> <span class="o">==</span> <span class="s2">&quot;VANILLALONGCALL&quot;</span><span class="p">:</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="mi">1</span>        
        <span class="n">delta_charge</span> <span class="o">=</span> <span class="p">(</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">spot</span><span class="o">/</span><span class="n">strike</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">sigma</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">))))</span> <span class="o">*</span> <span class="n">spot_spread</span> <span class="o">/</span> <span class="mi">2</span>        
    <span class="k">elif</span>  <span class="n">contract_type</span> <span class="o">==</span> <span class="s2">&quot;VANILLALONGPUT&quot;</span><span class="p">:</span>        
        <span class="n">phi</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>        
        <span class="n">delta_charge</span> <span class="o">=</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">spot</span><span class="o">/</span><span class="n">strike</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">sigma</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">)))</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="n">spot_spread</span> <span class="o">/</span> <span class="mi">2</span>        
    <span class="n">bs_price</span> <span class="o">=</span> <span class="p">(</span><span class="n">phi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">r</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">spot</span><span class="o">*</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">phi</span><span class="o">*</span><span class="n">d1</span><span class="p">)</span> <span class="o">-</span> <span class="n">strike</span><span class="o">*</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">phi</span><span class="o">*</span><span class="n">d2</span><span class="p">)))</span>    
    <span class="n">digits_precision</span> <span class="o">=</span> <span class="n">number_of_contracts</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
    <span class="n">digits_precision</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">digits_precision</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="k">else</span> <span class="nb">len</span><span class="p">(</span><span class="n">digits_precision</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">ppp</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">stake</span> <span class="o">/</span> <span class="p">(</span> <span class="n">bs_price</span> <span class="o">+</span> <span class="n">delta_charge</span> <span class="o">+</span> <span class="n">bs_markup</span> <span class="p">),</span> <span class="n">digits_precision</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ppp</span><span class="p">,</span> <span class="n">ppp</span> <span class="o">==</span> <span class="n">api_ppp</span></div>


<div class="viewcode-block" id="vanilla_payout">
<a class="viewcode-back" href="../index.html#mvapi.vanilla_payout">[docs]</a>
<span class="k">def</span> <span class="nf">vanilla_payout</span> <span class="p">(</span><span class="n">prop</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    payout, match_flag, close_flag </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">symbol</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;underlying&#39;</span><span class="p">]</span>
    <span class="n">ctype</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;contract_type&#39;</span><span class="p">]</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">ctype</span> <span class="o">==</span> <span class="s2">&quot;VANILLALONGCALL&quot;</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">spot</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;exit_tick&#39;</span><span class="p">]</span> 
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">spot</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;current_spot&#39;</span><span class="p">]</span>
    <span class="n">strike</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;barrier&#39;</span><span class="p">])</span>
    <span class="n">ppp</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;display_number_of_contracts&#39;</span><span class="p">])</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">tick_now</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;exit_tick_time&#39;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>                
        <span class="n">tick_now</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;current_spot_time&#39;</span><span class="p">]</span>
    <span class="n">R_expire_flag</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">symbol</span> <span class="ow">and</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;expiry_time&#39;</span><span class="p">]</span><span class="o">%</span><span class="mi">2</span> <span class="ow">and</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;expiry_time&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">tick_now</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">tick_now</span> <span class="o">&gt;=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;expiry_time&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">R_expire_flag</span><span class="p">:</span>
        <span class="n">payout</span><span class="p">,</span> <span class="n">close_flag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="nb">max</span><span class="p">((</span><span class="n">phi</span> <span class="o">*</span> <span class="n">ppp</span> <span class="o">*</span> <span class="p">(</span><span class="n">spot</span> <span class="o">-</span> <span class="n">strike</span><span class="p">)),</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;expired&#39;</span>
        <span class="n">match_flag</span> <span class="o">=</span> <span class="n">payout</span> <span class="o">==</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;sell_price&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;date_expiry&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">tick_now</span><span class="p">)</span> <span class="o">/</span> <span class="mi">365</span> <span class="o">/</span> <span class="mi">86400</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>                
            <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;date_expiry&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">tick_now</span><span class="p">)</span> <span class="o">/</span> <span class="mi">365</span> <span class="o">/</span> <span class="mi">86400</span>
        <span class="k">if</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="mi">5</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">/</span> <span class="mi">365</span> <span class="o">/</span> <span class="mi">86400</span> <span class="ow">and</span> <span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">symbol</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">-=</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">365</span> <span class="o">/</span> <span class="mi">86400</span>   
        <span class="n">r</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="s1">&#39;pricing_args&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;pricing_args&#39;</span><span class="p">][</span><span class="s1">&#39;discount_rate&#39;</span><span class="p">]</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="n">get_sigma</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>
        <span class="n">vol</span> <span class="o">=</span> <span class="n">sigma</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">BO</span><span class="p">[</span><span class="s1">&#39;vanillas&#39;</span><span class="p">][</span><span class="s1">&#39;vol_markup&#39;</span><span class="p">])</span>
        <span class="n">spot_spread</span> <span class="o">=</span> <span class="n">BO</span><span class="p">[</span><span class="s1">&#39;vanillas&#39;</span><span class="p">][</span><span class="s1">&#39;spread_spot&#39;</span><span class="p">][</span><span class="n">symbol</span><span class="p">]</span>
        <span class="n">bs_markup</span> <span class="o">=</span> <span class="n">BO</span><span class="p">[</span><span class="s1">&#39;vanillas&#39;</span><span class="p">][</span><span class="s1">&#39;bs_markup&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">phi</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">delta_charge</span> <span class="o">=</span> <span class="p">(</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">spot</span><span class="o">/</span><span class="n">strike</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">sigma</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">))))</span> <span class="o">*</span> <span class="n">spot_spread</span> <span class="o">/</span> <span class="mi">2</span>        
        <span class="k">else</span><span class="p">:</span>
            <span class="n">delta_charge</span> <span class="o">=</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">spot</span><span class="o">/</span><span class="n">strike</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">sigma</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">)))</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="n">spot_spread</span> <span class="o">/</span> <span class="mi">2</span>   
        <span class="n">d1</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">spot</span><span class="o">/</span><span class="n">strike</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">vol</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">vol</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
        <span class="n">d2</span> <span class="o">=</span> <span class="p">(</span><span class="n">d1</span> <span class="o">-</span> <span class="n">vol</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>    
        <span class="n">payout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="nb">max</span><span class="p">(((</span><span class="n">phi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">r</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">spot</span><span class="o">*</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">phi</span><span class="o">*</span><span class="n">d1</span><span class="p">)</span> <span class="o">-</span> <span class="n">strike</span><span class="o">*</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">phi</span><span class="o">*</span><span class="n">d2</span><span class="p">)))</span> <span class="o">-</span> <span class="n">delta_charge</span> <span class="o">-</span> <span class="n">bs_markup</span><span class="p">)</span> <span class="o">*</span> <span class="n">ppp</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">match_flag</span> <span class="o">=</span> <span class="p">(</span><span class="n">payout</span> <span class="o">==</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;bid_price&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="o">/</span><span class="mi">365</span> <span class="k">else</span> <span class="kc">True</span>
        <span class="n">close_flag</span> <span class="o">=</span> <span class="s1">&#39;sold&#39;</span> <span class="k">if</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;is_sold&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="s1">&#39;bid&#39;</span>
    <span class="k">return</span> <span class="n">payout</span><span class="p">,</span> <span class="n">match_flag</span><span class="p">,</span> <span class="n">close_flag</span></div>


<span class="c1"># Vanilla Class</span>
<div class="viewcode-block" id="Vanilla">
<a class="viewcode-back" href="../index.html#mvapi.Vanilla">[docs]</a>
<span class="k">class</span> <span class="nc">Vanilla</span><span class="p">(</span><span class="n">Product</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class to represent a Vanilla product, inheriting from the Product class.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        contract_type (str): The type of contract, either &#39;VANILLALONGCALL&#39; or &#39;VANILLALONGPUT&#39;.</span>
<span class="sd">        strike (str): The strike price for the contract.</span>
<span class="sd">        duration (int): The duration of the contract.</span>
<span class="sd">        duration_unit (str): The unit of the duration (&#39;m&#39; for minutes, &#39;h&#39; for hours, &#39;d&#39; for days).</span>

<span class="sd">    Methods:</span>
<span class="sd">        randomise_attributes(): Randomises the attributes of the Vanilla instance.</span>
<span class="sd">        _proposal(): Generates a proposal specific to the Vanilla product.</span>
<span class="sd">        check_barrier(runs=0, show=False): Validates the offered barriers in all proposals + for the given number of runs if defined.</span>
<span class="sd">        check_ask(runs=0, show=False): Validates the payout per point (ask price) in all proposals + for the given number of runs if defined.</span>
<span class="sd">        bid_check(runs=0, show=False): Validates the payout (bid price) in all proposals + for the given number of runs if defined.</span>
<span class="sd">    &quot;&quot;&quot;</span>
        
    <span class="n">species</span> <span class="o">=</span> <span class="s2">&quot;Vanilla&quot;</span>
    
<div class="viewcode-block" id="Vanilla.__init__">
<a class="viewcode-back" href="../index.html#mvapi.Vanilla.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strike</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;strike&#39;</span><span class="p">,</span> <span class="s1">&#39;+0.00&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contract_type</span> <span class="o">=</span> <span class="s1">&#39;VANILLALONGCALL&#39;</span> <span class="k">if</span> <span class="s1">&#39;c&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;contract_type&#39;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;VANILLALONGPUT&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;duration&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">duration_unit</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;duration_unit&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">)</span></div>

            
    <span class="c1"># randomise attributes </span>
<div class="viewcode-block" id="Vanilla.randomise_attributes">
<a class="viewcode-back" href="../index.html#mvapi.Vanilla.randomise_attributes">[docs]</a>
    <span class="k">def</span> <span class="nf">randomise_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symbol</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">symbols</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">duration_unit</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="s1">&#39;h&#39;</span><span class="p">,</span><span class="s1">&#39;d&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strike</span> <span class="o">=</span> <span class="s1">&#39;+0.00&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration_unit</span> <span class="o">!=</span> <span class="s1">&#39;d&#39;</span> <span class="k">else</span> <span class="s1">&#39;1000&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contract_type</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&#39;VANILLALONGCALL&#39;</span><span class="p">,</span><span class="s1">&#39;VANILLALONGPUT&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">61</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration_unit</span> <span class="o">==</span> <span class="s1">&#39;m&#39;</span> <span class="k">else</span>\
                        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">25</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration_unit</span> <span class="o">==</span> <span class="s1">&#39;h&#39;</span> <span class="k">else</span>\
                        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">14</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s1">&#39;1HZ250V&#39;</span> <span class="k">else</span> <span class="mi">40</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s1">&#39;1HZ150V&#39;</span> <span class="k">else</span> <span class="mi">365</span><span class="p">))</span> </div>

        
    <span class="c1"># Proposal generator</span>
<div class="viewcode-block" id="Vanilla._proposal">
<a class="viewcode-back" href="../index.html#mvapi.Vanilla._proposal">[docs]</a>
    <span class="k">def</span> <span class="nf">_proposal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">proposal</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">proposal_type</span> <span class="o">==</span> <span class="s1">&#39;price_proposal&#39;</span><span class="p">:</span>
            <span class="n">proposal</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;proposal&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;amount&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">stake</span><span class="p">,</span>
                <span class="s2">&quot;basis&quot;</span><span class="p">:</span> <span class="s2">&quot;stake&quot;</span><span class="p">,</span>
                <span class="s2">&quot;contract_type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">contract_type</span><span class="p">,</span>
                <span class="s2">&quot;currency&quot;</span><span class="p">:</span> <span class="s2">&quot;USD&quot;</span><span class="p">,</span>
                <span class="s2">&quot;symbol&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbol</span><span class="p">,</span>
                <span class="s1">&#39;barrier&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">strike</span><span class="p">,</span>
                <span class="s1">&#39;duration&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration</span><span class="p">,</span>
                <span class="s1">&#39;duration_unit&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration_unit</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_proposal</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">proposal</span><span class="p">)</span></div>


    <span class="c1"># check barriers for all proposals in messages and if specified, additional random contracts</span>
<div class="viewcode-block" id="Vanilla.check_barrier">
<a class="viewcode-back" href="../index.html#mvapi.Vanilla.check_barrier">[docs]</a>
    <span class="k">def</span> <span class="nf">check_barrier</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">runs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">show</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">runs</span><span class="p">):</span>
            <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">randomise_attributes</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_attributes</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">price_proposal</span><span class="p">()</span>
        <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;barrier_stats&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;cases&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;pass&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;fail&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;msg_type&#39;</span> <span class="ow">in</span> <span class="n">item</span> <span class="ow">and</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;msg_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;proposal&#39;</span> <span class="ow">and</span> <span class="s1">&#39;error&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
                <span class="n">temp_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;barrier_choices&#39;</span><span class="p">:</span> <span class="n">vanilla_barriers</span><span class="p">(</span><span class="n">item</span><span class="p">)}</span>
                <span class="n">insert_dict</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="s1">&#39;mv&#39;</span><span class="p">,</span> <span class="n">temp_dict</span><span class="p">)</span>    
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">barrier_pass_fail</span> <span class="o">=</span>  <span class="nb">all</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">bar</span><span class="p">)</span> <span class="k">for</span> <span class="n">bar</span> <span class="ow">in</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;proposal&#39;</span><span class="p">][</span><span class="s1">&#39;barrier_choices&#39;</span><span class="p">]]</span> <span class="o">==</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;mv&#39;</span><span class="p">][</span><span class="s1">&#39;barrier_choices&#39;</span><span class="p">])</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">item</span><span class="p">[</span><span class="s1">&#39;mv&#39;</span><span class="p">][</span><span class="s1">&#39;barrier_choices&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;mv&#39;</span><span class="p">][</span><span class="s1">&#39;barrier_choices&#39;</span><span class="p">])</span>
                    <span class="n">barrier_pass_fail</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">bar</span><span class="p">)</span> <span class="k">for</span> <span class="n">bar</span> <span class="ow">in</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;proposal&#39;</span><span class="p">][</span><span class="s1">&#39;barrier_choices&#39;</span><span class="p">]]</span> <span class="o">==</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;mv&#39;</span><span class="p">][</span><span class="s1">&#39;barrier_choices&#39;</span><span class="p">]</span>
                <span class="n">item</span><span class="p">[</span><span class="s1">&#39;mv&#39;</span><span class="p">][</span><span class="s1">&#39;barrier_check&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">barrier_pass_fail</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;barrier_stats&#39;</span><span class="p">][</span><span class="s1">&#39;cases&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">barrier_pass_fail</span><span class="p">:</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;barrier_stats&#39;</span><span class="p">][</span><span class="s1">&#39;pass&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;barrier_stats&#39;</span><span class="p">][</span><span class="s1">&#39;fail&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>               
                <span class="k">if</span> <span class="ow">not</span> <span class="n">barrier_pass_fail</span> <span class="ow">and</span> <span class="n">show</span><span class="p">:</span>
                    <span class="n">display</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stats_barrier</span> <span class="o">=</span> <span class="n">dict_to_df</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;barrier_stats&#39;</span><span class="p">],</span> <span class="s1">&#39;Barrier&#39;</span><span class="p">)</span></div>


    <span class="c1"># check ask price for all proposals in messages and if specified, additional random contracts                      </span>
<div class="viewcode-block" id="Vanilla.check_ask">
<a class="viewcode-back" href="../index.html#mvapi.Vanilla.check_ask">[docs]</a>
    <span class="k">def</span> <span class="nf">check_ask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">runs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">show</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">runs</span><span class="p">):</span>
            <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">randomise_attributes</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_attributes</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">price_proposal</span><span class="p">()</span>
        <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;ask_stats&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;cases&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;pass&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;fail&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>        
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;msg_type&#39;</span> <span class="ow">in</span> <span class="n">item</span> <span class="ow">and</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;msg_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;proposal&#39;</span> <span class="ow">and</span> <span class="s1">&#39;error&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
                <span class="n">temp_dict</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;ask_ppp&#39;</span><span class="p">],</span> <span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;ask_ppp_check&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vanilla_ppp_ask</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>                
                <span class="n">insert_dict</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="s1">&#39;mv&#39;</span><span class="p">,</span> <span class="n">temp_dict</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;ask_stats&#39;</span><span class="p">][</span><span class="s1">&#39;cases&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;mv&#39;</span><span class="p">][</span><span class="s1">&#39;ask_ppp_check&#39;</span><span class="p">]:</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;ask_stats&#39;</span><span class="p">][</span><span class="s1">&#39;pass&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;ask_stats&#39;</span><span class="p">][</span><span class="s1">&#39;fail&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>                    
                <span class="k">if</span> <span class="ow">not</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;mv&#39;</span><span class="p">][</span><span class="s1">&#39;ask_ppp_check&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">show</span><span class="p">:</span>
                    <span class="n">display</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stats_ask</span> <span class="o">=</span> <span class="n">dict_to_df</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;ask_stats&#39;</span><span class="p">],</span> <span class="s1">&#39;Ask Price&#39;</span><span class="p">)</span></div>

                       
    <span class="c1"># check ask price for all proposals in messages and if specified, additional random contracts                      </span>
<div class="viewcode-block" id="Vanilla.check_payout">
<a class="viewcode-back" href="../index.html#mvapi.Vanilla.check_payout">[docs]</a>
    <span class="k">def</span> <span class="nf">check_payout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">runs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">show</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        to check payout obviously /s</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">runs</span><span class="p">):</span>
            <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">buy_contract</span><span class="p">(</span><span class="n">random</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_all_poc</span><span class="p">()</span>
        <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;cases&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;pass&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;fail&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
            <span class="s1">&#39;expired&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;cases&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;pass&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;fail&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
            <span class="s1">&#39;sold&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;cases&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;pass&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;fail&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
            <span class="s1">&#39;bid&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;cases&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;pass&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;fail&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;msg_type&#39;</span> <span class="ow">in</span> <span class="n">item</span> <span class="ow">and</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;msg_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;proposal_open_contract&#39;</span> <span class="ow">and</span> <span class="s1">&#39;error&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
                <span class="n">temp_dict</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;payout&#39;</span><span class="p">],</span> <span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">],</span> <span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;close_flag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vanilla_payout</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> 
                <span class="n">insert_dict</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="s1">&#39;mv&#39;</span><span class="p">,</span> <span class="n">temp_dict</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">][</span><span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;close_flag&#39;</span><span class="p">]][</span><span class="s1">&#39;cases&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="s1">&#39;cases&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;mv&#39;</span><span class="p">][</span><span class="s1">&#39;payout_check&#39;</span><span class="p">]:</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">][</span><span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;close_flag&#39;</span><span class="p">]][</span><span class="s1">&#39;pass&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="s1">&#39;pass&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">][</span><span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;close_flag&#39;</span><span class="p">]][</span><span class="s1">&#39;fail&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>  
                    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="s1">&#39;fail&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;mv&#39;</span><span class="p">][</span><span class="s1">&#39;payout_check&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">show</span><span class="p">:</span>
                    <span class="n">display</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">stats_payout</span> <span class="o">=</span> <span class="n">dict_to_df</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">],</span> <span class="s1">&#39;Payout&#39;</span><span class="p">)</span></div>
</div>


<div class="viewcode-block" id="turbo_ask">
<a class="viewcode-back" href="../index.html#mvapi.turbo_ask">[docs]</a>
<span class="k">def</span> <span class="nf">turbo_ask</span> <span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">spot</span><span class="p">,</span> <span class="n">barrier</span><span class="p">,</span> <span class="n">duration_unit</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculates the ask price for 1 turbo contract&quot;&quot;&quot;</span>
    <span class="n">tick_comm</span> <span class="o">=</span> <span class="s1">&#39;tick_comm_&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;up&#39;</span> <span class="k">if</span> <span class="n">phi</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s1">&#39;down&#39;</span><span class="p">)</span>
    <span class="n">tick_comm</span> <span class="o">+=</span> <span class="s1">&#39;_t&#39;</span> <span class="k">if</span>  <span class="n">duration_unit</span> <span class="o">==</span> <span class="s1">&#39;t&#39;</span> <span class="k">else</span>  <span class="s1">&#39;_d&#39;</span> <span class="k">if</span> <span class="n">duration_unit</span> <span class="o">==</span> <span class="s1">&#39;d&#39;</span> <span class="k">else</span> <span class="s1">&#39;_i&#39;</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(\d+)[^\d]*$&#39;</span><span class="p">,</span> <span class="n">symbol</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="mi">100</span>
    <span class="n">is_r</span> <span class="o">=</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;R&#39;</span><span class="p">),</span> <span class="n">symbol</span><span class="p">)</span> <span class="k">else</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">phi</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">commup</span> <span class="o">=</span> <span class="n">BO</span><span class="p">[</span><span class="s1">&#39;turbos&#39;</span><span class="p">][</span><span class="n">tick_comm</span><span class="p">][</span><span class="n">symbol</span><span class="p">]</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">is_r</span><span class="o">/</span><span class="mi">365</span><span class="o">/</span><span class="mi">86400</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">spot</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">commup</span><span class="p">)</span> <span class="o">-</span> <span class="n">barrier</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">commdown</span> <span class="o">=</span> <span class="n">BO</span><span class="p">[</span><span class="s1">&#39;turbos&#39;</span><span class="p">][</span><span class="n">tick_comm</span><span class="p">][</span><span class="n">symbol</span><span class="p">]</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">is_r</span><span class="o">/</span><span class="mi">365</span><span class="o">/</span><span class="mi">86400</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">barrier</span> <span class="o">-</span> <span class="n">spot</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">commdown</span><span class="p">)</span> </div>


<div class="viewcode-block" id="turbo_barrier">
<a class="viewcode-back" href="../index.html#mvapi.turbo_barrier">[docs]</a>
<span class="k">def</span> <span class="nf">turbo_barrier</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="n">start_of_min_spot</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate expected barrier from proposal&quot;&quot;&quot;</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;echo_req&#39;</span><span class="p">][</span><span class="s1">&#39;contract_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;TURBOSLONG&#39;</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">symbol</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;echo_req&#39;</span><span class="p">][</span><span class="s1">&#39;symbol&#39;</span><span class="p">]</span>
    <span class="n">spot</span> <span class="o">=</span> <span class="n">start_of_min_spot</span>
    <span class="n">ppp</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;echo_req&#39;</span><span class="p">][</span><span class="s1">&#39;payout_per_point&#39;</span><span class="p">]</span>
    <span class="n">stake</span> <span class="o">=</span> <span class="n">get_stake</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
    <span class="n">tick_comm</span> <span class="o">=</span> <span class="s1">&#39;tick_comm_&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;up&#39;</span> <span class="k">if</span> <span class="n">phi</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s1">&#39;down&#39;</span><span class="p">)</span>
    <span class="n">tick_comm</span> <span class="o">+=</span> <span class="s1">&#39;_t&#39;</span> <span class="k">if</span>  <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;echo_req&#39;</span><span class="p">][</span><span class="s1">&#39;duration_unit&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;t&#39;</span> <span class="k">else</span>  <span class="s1">&#39;_d&#39;</span> <span class="k">if</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;echo_req&#39;</span><span class="p">][</span><span class="s1">&#39;duration_unit&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;d&#39;</span> <span class="k">else</span> <span class="s1">&#39;_i&#39;</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">get_sigma</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>
    <span class="n">is_r</span> <span class="o">=</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;R&#39;</span><span class="p">),</span> <span class="n">symbol</span><span class="p">)</span> <span class="k">else</span> <span class="mi">1</span>
    <span class="n">comm</span> <span class="o">=</span> <span class="n">BO</span><span class="p">[</span><span class="s1">&#39;turbos&#39;</span><span class="p">][</span><span class="n">tick_comm</span><span class="p">][</span><span class="n">symbol</span><span class="p">]</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">is_r</span><span class="o">/</span><span class="mi">365</span><span class="o">/</span><span class="mi">86400</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">phi</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">barrier</span> <span class="o">=</span> <span class="n">roundup</span><span class="p">(</span><span class="n">spot</span> <span class="o">*</span> <span class="n">comm</span> <span class="o">-</span> <span class="n">stake</span><span class="o">/</span><span class="n">ppp</span><span class="p">,</span> <span class="n">symbols</span><span class="p">[</span><span class="n">symbol</span><span class="p">][</span><span class="s1">&#39;precision&#39;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">barrier</span> <span class="o">=</span> <span class="n">rounddown</span><span class="p">(</span><span class="n">stake</span><span class="o">/</span><span class="n">ppp</span> <span class="o">-</span> <span class="n">spot</span> <span class="o">*</span> <span class="n">comm</span><span class="p">,</span> <span class="n">symbols</span><span class="p">[</span><span class="n">symbol</span><span class="p">][</span><span class="s1">&#39;precision&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal&#39;</span><span class="p">][</span><span class="s1">&#39;spot&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">barrier</span><span class="p">,</span> <span class="n">symbols</span><span class="p">[</span><span class="n">symbol</span><span class="p">][</span><span class="s1">&#39;precision&#39;</span><span class="p">])</span> </div>

    
<div class="viewcode-block" id="turbo_ppps">
<a class="viewcode-back" href="../index.html#mvapi.turbo_ppps">[docs]</a>
<span class="k">def</span> <span class="nf">turbo_ppps</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="n">start_of_min_spot</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculates the expected offered payout_per_point choices from the given json&quot;&quot;&quot;</span>
    <span class="n">stake</span> <span class="o">=</span> <span class="n">get_stake</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="s1">&#39;LONG&#39;</span> <span class="ow">in</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;echo_req&#39;</span><span class="p">][</span><span class="s1">&#39;contract_type&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">symbol</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;echo_req&#39;</span><span class="p">][</span><span class="s1">&#39;symbol&#39;</span><span class="p">]</span>
    <span class="n">spot</span> <span class="o">=</span> <span class="n">start_of_min_spot</span>
    <span class="n">duration_unit</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;echo_req&#39;</span><span class="p">][</span><span class="s1">&#39;duration_unit&#39;</span><span class="p">]</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(\d+)[^\d]*$&#39;</span><span class="p">,</span> <span class="n">symbol</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="mi">100</span>
    <span class="n">barrier_far</span> <span class="o">=</span> <span class="n">spot</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">phi</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">BO</span><span class="p">[</span><span class="s1">&#39;turbos&#39;</span><span class="p">][</span><span class="s1">&#39;T_max&#39;</span><span class="p">][</span><span class="n">symbol</span><span class="p">]</span><span class="o">/</span><span class="mi">365</span><span class="o">/</span><span class="mi">86400</span><span class="p">))</span>
    <span class="n">barrier_close</span> <span class="o">=</span> <span class="n">spot</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">phi</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">BO</span><span class="p">[</span><span class="s1">&#39;turbos&#39;</span><span class="p">][</span><span class="s1">&#39;T_min&#39;</span><span class="p">][</span><span class="n">symbol</span><span class="p">]</span><span class="o">/</span><span class="mi">365</span><span class="o">/</span><span class="mi">86400</span><span class="p">))</span>
    <span class="n">n_far</span> <span class="o">=</span> <span class="n">stake</span> <span class="o">/</span> <span class="n">turbo_ask</span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">spot</span><span class="p">,</span> <span class="n">barrier_far</span><span class="p">,</span> <span class="n">duration_unit</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>
    <span class="n">n_close</span> <span class="o">=</span> <span class="n">stake</span> <span class="o">/</span> <span class="n">turbo_ask</span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">spot</span><span class="p">,</span> <span class="n">barrier_close</span><span class="p">,</span> <span class="n">duration_unit</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>
    <span class="n">increment</span> <span class="o">=</span>  <span class="n">roundsf</span><span class="p">((</span><span class="n">n_close</span> <span class="o">-</span> <span class="n">n_far</span><span class="p">)</span> <span class="o">*</span> <span class="n">BO</span><span class="p">[</span><span class="s1">&#39;turbos&#39;</span><span class="p">][</span><span class="s1">&#39;ip&#39;</span><span class="p">][</span><span class="n">symbol</span><span class="p">])</span>
    <span class="n">tn</span> <span class="o">=</span> <span class="n">roundup</span><span class="p">(</span><span class="n">n_far</span><span class="o">/</span><span class="n">increment</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="c1">#tn is the smallests ppp</span>
    <span class="n">t0</span> <span class="o">=</span> <span class="n">rounddown</span><span class="p">(</span><span class="n">n_close</span><span class="o">/</span><span class="n">increment</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="c1">#t0 is the largest</span>
    <span class="n">ppp</span> <span class="o">=</span> <span class="p">[</span><span class="n">tn</span><span class="o">*</span><span class="n">increment</span><span class="p">]</span>
    <span class="k">while</span> <span class="n">ppp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">t0</span><span class="o">*</span><span class="n">increment</span><span class="p">:</span>
        <span class="n">ppp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">ppp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">increment</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>
    <span class="n">ppp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ppp</span><span class="p">)</span>
    <span class="n">offered_pps</span> <span class="o">=</span> <span class="n">ppp</span><span class="p">[</span><span class="n">ppp</span> <span class="o">&lt;=</span> <span class="nb">round</span><span class="p">(</span><span class="n">t0</span><span class="o">*</span><span class="n">increment</span><span class="p">,</span><span class="mi">12</span><span class="p">)]</span>
    <span class="n">barrier</span> <span class="o">=</span> <span class="n">turbo_barrier</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="n">spot</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">offered_pps</span><span class="p">,</span> <span class="n">barrier</span><span class="p">,</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">offered_pps</span><span class="p">)</span> <span class="o">==</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal&#39;</span><span class="p">][</span><span class="s1">&#39;payout_choices&#39;</span><span class="p">])</span> <span class="ow">and</span> <span class="n">barrier</span> <span class="o">==</span> <span class="nb">float</span><span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal&#39;</span><span class="p">][</span><span class="s1">&#39;contract_details&#39;</span><span class="p">][</span><span class="s1">&#39;barrier&#39;</span><span class="p">])</span></div>


<div class="viewcode-block" id="turbo_payout">
<a class="viewcode-back" href="../index.html#mvapi.turbo_payout">[docs]</a>
<span class="k">def</span> <span class="nf">turbo_payout</span> <span class="p">(</span><span class="n">prop</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    payout, match_flag, close_flag </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">symbol</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;underlying&#39;</span><span class="p">]</span>
    <span class="n">is_r</span> <span class="o">=</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;R&#39;</span><span class="p">),</span> <span class="n">symbol</span><span class="p">)</span> <span class="k">else</span> <span class="mi">1</span>
    <span class="n">ctype</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;contract_type&#39;</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">spot</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;exit_tick&#39;</span><span class="p">]</span> 
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">spot</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;current_spot&#39;</span><span class="p">]</span>
    <span class="n">barrier</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;barrier&#39;</span><span class="p">])</span>
    <span class="n">bid_price</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;bid_price&#39;</span><span class="p">]</span>
    
    <span class="n">ppp</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;display_number_of_contracts&#39;</span><span class="p">])</span>
    <span class="n">shortcode</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;shortcode&#39;</span><span class="p">]</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">get_sigma</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;exit_tick_time&#39;</span> <span class="ow">in</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;exit_tick_time&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;expiry_time&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ctype</span> <span class="o">==</span> <span class="s1">&#39;TURBOSLONG&#39;</span> <span class="ow">and</span> <span class="n">spot</span> <span class="o">&lt;=</span> <span class="n">barrier</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">ctype</span> <span class="o">==</span> <span class="s1">&#39;TURBOSSHORT&#39;</span> <span class="ow">and</span> <span class="n">spot</span> <span class="o">&gt;=</span> <span class="n">barrier</span><span class="p">):</span>
            <span class="n">payout</span><span class="p">,</span> <span class="n">close_flag</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;ko&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">payout</span><span class="p">,</span> <span class="n">close_flag</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">spot</span> <span class="o">-</span> <span class="n">barrier</span><span class="p">)</span> <span class="o">*</span> <span class="n">ppp</span><span class="p">,</span> <span class="s1">&#39;expired&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">comm</span> <span class="o">=</span> <span class="s1">&#39;down_&#39;</span><span class="k">if</span> <span class="n">ctype</span> <span class="o">==</span> <span class="s1">&#39;TURBOSLONG&#39;</span> <span class="k">else</span> <span class="s1">&#39;up_&#39;</span>
        <span class="n">comm</span> <span class="o">+=</span> <span class="s1">&#39;t&#39;</span> <span class="k">if</span> <span class="s1">&#39;T&#39;</span> <span class="ow">in</span> <span class="n">shortcode</span><span class="p">[</span><span class="mi">11</span><span class="p">:]</span> <span class="k">else</span> <span class="s1">&#39;i&#39;</span> <span class="k">if</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;is_intraday&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="s1">&#39;d&#39;</span>
        <span class="n">comm</span> <span class="o">=</span> <span class="s1">&#39;tick_comm_&#39;</span> <span class="o">+</span> <span class="n">comm</span>
        <span class="n">comm</span> <span class="o">=</span> <span class="n">BO</span><span class="p">[</span><span class="s1">&#39;turbos&#39;</span><span class="p">][</span><span class="n">comm</span><span class="p">][</span><span class="n">symbol</span><span class="p">]</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">is_r</span><span class="o">/</span><span class="mi">365</span><span class="o">/</span><span class="mi">86400</span><span class="p">)</span>
        <span class="n">payout</span><span class="p">,</span> <span class="n">close_flag</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span> <span class="p">(</span><span class="n">spot</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">comm</span><span class="p">)</span> <span class="o">-</span> <span class="n">barrier</span><span class="p">)</span> <span class="o">*</span> <span class="n">ppp</span> <span class="k">if</span> <span class="n">ctype</span> <span class="o">==</span> <span class="s1">&#39;TURBOSLONG&#39;</span> <span class="k">else</span> <span class="p">(</span><span class="n">barrier</span> <span class="o">-</span> <span class="n">spot</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">comm</span><span class="p">))</span> <span class="o">*</span> <span class="n">ppp</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="s1">&#39;sold&#39;</span> <span class="k">if</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;is_sold&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="s1">&#39;bid&#39;</span>
    <span class="n">match_flag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">payout</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="n">bid_price</span>
    <span class="k">return</span> <span class="n">payout</span><span class="p">,</span> <span class="n">match_flag</span><span class="p">,</span> <span class="n">close_flag</span></div>


<div class="viewcode-block" id="Turbo">
<a class="viewcode-back" href="../index.html#mvapi.Turbo">[docs]</a>
<span class="k">class</span> <span class="nc">Turbo</span><span class="p">(</span><span class="n">Product</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class to represent a Turbo product, inheriting from the Product class.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        species (str): The type of the product, &#39;turbo&#39;.</span>
<span class="sd">        strike (str): The strike price for the contract, default is &#39;+10.00&#39;.</span>
<span class="sd">        payout_per_point (float): The payout per point, default is 2.</span>
<span class="sd">        contract_type (str): The type of contract, either &#39;TURBOSLONG&#39; or &#39;TURBOSSHORT&#39;.</span>
<span class="sd">        duration (int): The duration of the contract, default is 5.</span>
<span class="sd">        duration_unit (str): The unit of the duration (&#39;t&#39; for ticks, &#39;s&#39; for seconds, &#39;m&#39; for minutes, &#39;h&#39; for hours, &#39;d&#39; for days).</span>

<span class="sd">    Methods:</span>
<span class="sd">        randomise_attributes(): Randomises the attributes of the Turbo instance.</span>
<span class="sd">        _proposal(): Generates a proposal specific to the Turbo product.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">species</span> <span class="o">=</span> <span class="s2">&quot;Turbo&quot;</span>
    
<div class="viewcode-block" id="Turbo.__init__">
<a class="viewcode-back" href="../index.html#mvapi.Turbo.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strike</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;strike&#39;</span><span class="p">,</span> <span class="s1">&#39;+10.00&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">payout_per_point</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;payout_per_point&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contract_type</span> <span class="o">=</span> <span class="s1">&#39;TURBOSLONG&#39;</span> <span class="k">if</span> <span class="s1">&#39;long&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;contract_type&#39;</span><span class="p">,</span> <span class="s1">&#39;TURBOSLONG&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;TURBOSSHORT&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;duration&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">duration_unit</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;duration_unit&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ver&#39;</span><span class="p">,</span> <span class="s1">&#39;revamp&#39;</span><span class="p">)</span></div>

            
    <span class="c1"># randomise attributes </span>
<div class="viewcode-block" id="Turbo.randomise_attributes">
<a class="viewcode-back" href="../index.html#mvapi.Turbo.randomise_attributes">[docs]</a>
    <span class="k">def</span> <span class="nf">randomise_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symbol</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">symbols</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">duration_unit</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="s1">&#39;h&#39;</span><span class="p">,</span><span class="s1">&#39;d&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strike</span> <span class="o">=</span> <span class="s1">&#39;+10.00&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">payout_per_point</span> <span class="o">=</span> <span class="mf">2.00001</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contract_type</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&#39;TURBOSLONG&#39;</span><span class="p">,</span><span class="s1">&#39;TURBOSSHORT&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration_unit</span> <span class="o">==</span> <span class="s1">&#39;t&#39;</span> <span class="k">else</span>\
                        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">86401</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration_unit</span> <span class="o">==</span> <span class="s1">&#39;s&#39;</span> <span class="k">else</span>\
                        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1441</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration_unit</span> <span class="o">==</span> <span class="s1">&#39;m&#39;</span> <span class="k">else</span>\
                        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration_unit</span> <span class="o">==</span> <span class="s1">&#39;h&#39;</span> <span class="k">else</span>\
                        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">365</span><span class="p">)</span> </div>

        
    <span class="c1"># Proposal generator</span>
<div class="viewcode-block" id="Turbo._proposal">
<a class="viewcode-back" href="../index.html#mvapi.Turbo._proposal">[docs]</a>
    <span class="k">def</span> <span class="nf">_proposal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">proposal</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">proposal_type</span> <span class="o">==</span> <span class="s1">&#39;price_proposal&#39;</span><span class="p">:</span>
            <span class="n">proposal</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;proposal&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;amount&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">stake</span><span class="p">,</span>
                <span class="s2">&quot;basis&quot;</span><span class="p">:</span> <span class="s2">&quot;stake&quot;</span><span class="p">,</span>
                <span class="s2">&quot;contract_type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">contract_type</span><span class="p">,</span>
                <span class="s2">&quot;currency&quot;</span><span class="p">:</span> <span class="s2">&quot;USD&quot;</span><span class="p">,</span>
                <span class="s2">&quot;symbol&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbol</span><span class="p">,</span>
                <span class="s1">&#39;duration&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration</span><span class="p">,</span>
                <span class="s1">&#39;duration_unit&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration_unit</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">==</span> <span class="s1">&#39;revamp&#39;</span><span class="p">:</span>
                <span class="n">proposal</span><span class="p">[</span><span class="s1">&#39;payout_per_point&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">payout_per_point</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">proposal</span><span class="p">[</span><span class="s1">&#39;barrier&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">strike</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_proposal</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">proposal</span><span class="p">)</span></div>


<div class="viewcode-block" id="Turbo.get_start_of_min_tick">
<a class="viewcode-back" href="../index.html#mvapi.Turbo.get_start_of_min_tick">[docs]</a>
    <span class="k">def</span> <span class="nf">get_start_of_min_tick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">):</span>
        <span class="n">cur_time</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal&#39;</span><span class="p">][</span><span class="s1">&#39;date_start&#39;</span><span class="p">]</span>
        <span class="n">start_of_min</span> <span class="o">=</span> <span class="n">cur_time</span> <span class="o">-</span> <span class="n">cur_time</span><span class="o">%</span><span class="mi">60</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tick_history</span><span class="p">(</span><span class="n">symbol</span><span class="o">=</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;echo_req&#39;</span><span class="p">][</span><span class="s1">&#39;symbol&#39;</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="n">start_of_min</span><span class="p">)[</span><span class="s1">&#39;history&#39;</span><span class="p">][</span><span class="s1">&#39;prices&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span></div>

            
<div class="viewcode-block" id="Turbo.check_ppps">
<a class="viewcode-back" href="../index.html#mvapi.Turbo.check_ppps">[docs]</a>
    <span class="k">def</span> <span class="nf">check_ppps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">runs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">show</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">runs</span><span class="p">):</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.71</span><span class="p">)</span>
            <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">randomise_attributes</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_attributes</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">price_proposal</span><span class="p">()</span>
        <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;ppp_choices_stats&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;cases&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;pass&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;fail&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;msg_type&#39;</span> <span class="ow">in</span> <span class="n">item</span> <span class="ow">and</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;msg_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;proposal&#39;</span> <span class="ow">and</span> <span class="s1">&#39;error&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
                <span class="c1"># if &#39;mv&#39; not in item or (&#39;mv&#39; in item and &#39;ppp_choices_stats&#39; not in item[&#39;mv&#39;]): # some fixing needs to be done here to prevent lost of results.</span>
                <span class="n">display</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="n">temp_dict</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">start_of_min_spot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_start_of_min_tick</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;payout_choices&#39;</span><span class="p">],</span> <span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;barrier&#39;</span><span class="p">],</span> <span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;ppp_choices_stats&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">turbo_ppps</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">start_of_min_spot</span><span class="p">)</span>
                <span class="n">insert_dict</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="s1">&#39;mv&#39;</span><span class="p">,</span> <span class="n">temp_dict</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;ppp_choices_stats&#39;</span><span class="p">][</span><span class="s1">&#39;cases&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;mv&#39;</span><span class="p">][</span><span class="s1">&#39;ppp_choices_stats&#39;</span><span class="p">]:</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;ppp_choices_stats&#39;</span><span class="p">][</span><span class="s1">&#39;pass&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;ppp_choices_stats&#39;</span><span class="p">][</span><span class="s1">&#39;fail&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;msg_type&#39;</span> <span class="ow">in</span> <span class="n">item</span> <span class="ow">and</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;msg_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;proposal&#39;</span> <span class="ow">and</span> <span class="s1">&#39;error&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;mv&#39;</span><span class="p">][</span><span class="s1">&#39;ppp_choices_stats&#39;</span><span class="p">]:</span>
                    <span class="n">display</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>                     
        <span class="bp">self</span><span class="o">.</span><span class="n">stats_ppp_choices</span> <span class="o">=</span> <span class="n">dict_to_df</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;ppp_choices_stats&#39;</span><span class="p">],</span> <span class="s1">&#39;PPP Choices&#39;</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="Turbo.check_payout">
<a class="viewcode-back" href="../index.html#mvapi.Turbo.check_payout">[docs]</a>
    <span class="k">def</span> <span class="nf">check_payout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">runs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">show</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        to check payout obviously /s</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">runs</span><span class="p">):</span>
            <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">buy_contract</span><span class="p">(</span><span class="n">random</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_all_poc</span><span class="p">()</span>
        <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;cases&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;pass&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;fail&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
            <span class="s1">&#39;ko&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;cases&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;pass&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;fail&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
            <span class="s1">&#39;expired&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;cases&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;pass&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;fail&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
            <span class="s1">&#39;sold&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;cases&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;pass&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;fail&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
            <span class="s1">&#39;bid&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;cases&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;pass&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;fail&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;msg_type&#39;</span> <span class="ow">in</span> <span class="n">item</span> <span class="ow">and</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;msg_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;proposal_open_contract&#39;</span> <span class="ow">and</span> <span class="s1">&#39;error&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
                <span class="n">temp_dict</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;payout&#39;</span><span class="p">],</span> <span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">],</span> <span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;close_flag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">turbo_payout</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> 
                <span class="n">insert_dict</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="s1">&#39;mv&#39;</span><span class="p">,</span> <span class="n">temp_dict</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">][</span><span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;close_flag&#39;</span><span class="p">]][</span><span class="s1">&#39;cases&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="s1">&#39;cases&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;mv&#39;</span><span class="p">][</span><span class="s1">&#39;payout_check&#39;</span><span class="p">]:</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">][</span><span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;close_flag&#39;</span><span class="p">]][</span><span class="s1">&#39;pass&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="s1">&#39;pass&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">][</span><span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;close_flag&#39;</span><span class="p">]][</span><span class="s1">&#39;fail&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>  
                    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="s1">&#39;fail&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;mv&#39;</span><span class="p">][</span><span class="s1">&#39;payout_check&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">show</span><span class="p">:</span>
                    <span class="n">display</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">stats_payout</span> <span class="o">=</span> <span class="n">dict_to_df</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">],</span> <span class="s1">&#39;Payout&#39;</span><span class="p">)</span></div>
</div>



<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Matthew-Deriv, VishalMenon-Deriv.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>